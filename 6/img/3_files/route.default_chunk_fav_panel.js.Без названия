(window.webpackJsonp=window.webpackJsonp||[]).push([[146],{1009:function(e,t,i){"use strict";var s=i(0),r=i(92),n=i(34),a={calculateSizeMp:function(e,t){var i=(e.width*e.height/1e6).toFixed(2),s=1e6*t.threshold,r=i<t.threshold;return{max:r,width:r?e.width:Math.round(Math.sqrt(s*e.width/e.height)),height:r?e.height:Math.round(Math.sqrt(s*e.height/e.width))}},calculateSizeFixed:function(e,t){var i=e.width<=t.threshold.width&&e.height<=t.threshold.height;return{max:i,width:i?e.width:t.threshold.width,height:i?e.height:t.threshold.height}},calculateSizeBroadSide:function(e,t){var i=!t.threshold||"extended"===t.license||"standard"===t.license&&t.threshold&&e.width<t.threshold.width&&e.height<t.threshold.height;return i?{max:i,width:e.width,height:e.height}:{max:i,width:e.width>=e.height?t.threshold.width:Math.round(e.width*(t.threshold.width/e.height)),height:e.width<e.height?t.threshold.height:Math.round(e.height*(t.threshold.width/e.width))}},calculateSizeBroadSideDoubled:function(e,t){var i=a.calculateSizeBroadSide(e,t);return i.width*=2,i.height*=2,i},calculateSizeConst:function(e,t){return{width:t.threshold.width,height:t.threshold.height}},makeSize:function(e,t,i){if("video"===e.get("type")){var s="@ "+e.get("fps")+" fps";return{value:s,extendedValue:s,tooltip:!1}}if("vector"===e.get("type")&&["vect","el0"].includes(t.id))return{value:r.ScalableToAnySize,extendedValue:r.ScalableToAnySize,tooltip:!0};var o={inch:function(e){return(e/t.dpi).toFixed(2)},cm:function(e){return(e/t.dpi*2.54).toFixed(2)}},l=t.algo?t.algo.replace(/(^|_)([a-z])/gi,(function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return t[2].toUpperCase()})):null,c=a["calculateSize"+l](e.attributes,t),d=[i,"inch","cm"].reduce((function(e,t){return e[t]=e[t]||function(e){return{width:o[e](c.width),height:o[e](c.height),unit:n.sizes.find((function(t){return t.key===e})).value}}(t),e}),{});return{value:""+d[i].width+d[i].unit+" &times; "+d[i].height+d[i].unit+" ("+t.dpi+"&nbsp;dpi)",extendedValue:""+d[i].width+d[i].unit+" &times; "+d[i].height+d[i].unit+", "+t.dpi+"&nbsp;dpi",tooltip:!1}},makeSizeLabel:function(e,t){if("vector"===e.type&&["el0","vect"].includes(t.id))return r.VectImage;var i=t.algo?t.algo.replace(/(^|_)([a-z])/gi,(function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return t[2].toUpperCase()})):null,s=a["calculateSize"+i](e,t);return s.width+" &times; "+s.height}};e.exports.calculateSizeMp=a.calculateSizeMp,e.exports.calculateSizeFixed=a.calculateSizeFixed,e.exports.calculateSizeBroadSide=a.calculateSizeBroadSide,e.exports.calculateSizeBroadSideDoubled=a.calculateSizeBroadSideDoubled,e.exports.makeSize=a.makeSize,e.exports.makeSizeLabel=a.makeSizeLabel,e.exports.makeExtension=function(e,t){var i="vector"===e&&["el0","vect"].includes(t.id)?"eps":"jpg";return s.findWhere([{key:"jpg",label:"JPG"},{key:"eps",label:"EPS"},{key:"mov",label:"MOV",tip:"Mac- &amp; Windows-friendly format, native to Apple's QuickTime video software."}],{key:"video"===e?"mov":i})}},1069:function(e,t,i){"use strict";var s=i(0),r=i(152),n=i(796),a=i(982),o=a.prepareFilename,l=a.prepareThumbFilename,c=a.prepareFileEnding,d=i(6);e.exports=d.extend({url:"File",defaults:{id:null,type:null,width:null,height:null,schema:[],sizeMask:0,licenseMask:0,permissionMask:0,sellerId:null,filename:"",thumbs:[],thumbSource:"",hasHugeImageThumb:!1,hasHugeVectorThumb:!1,hasHugeVideoThumb:!1},parse:function(e){var t=this.getRespErrors(e);if(Object.keys(t).length)return this.validationError=t,this.trigger("invalid",this,t,{validationError:t}),{};var i=s.pick(e,Object.keys(this.defaults));return i.type={i:"image",t:"vector",v:"video"}[e.type]||e.type,i},serialize:function(){var e=d.prototype.serialize.call(this);return e.thumbs=this.makeThumbs(),e.url=e.url||this.makeUrl(this.attributes),e},makeThumb:function(e){return n.getThumbUrl({size:e,file:this.attributes,protocol:this.app.parsedUrl.protocol,genFilename:l.bind(this,this.app)})},makeThumbs:function(){var e=this;return["normal","normalSquare","big","wideSmall","bigWide","wide","xwide","huge","large","max"].reduce((function(t,i){return t[i]=e.makeThumb(i),t}),{})},makeUrl:function(e,t){return void 0===e&&(e=this.attributes),this.app.makeUrl({route:"FileView",fileUrl:"/"+(1===e.nudity?"n/":"")+e.id+"/"+o(this.app,e,t)+c(this.app,e,t)+".html"},{absolute:!0})},toTracking:function(){return{id:this.get("id"),type:this.get("type"),position:this.collection&&this.collection.indexOf(this)+1||0}},getRespErrors:function(e){var t=this;void 0===e&&(e={});var i={};return(e.errors||[]).forEach((function(e){if((i[e.error_code]||(i[e.error_code]=[])).push(e.error_message),(i.id||(i.id=[])).push(e.error_message),e.error_data)switch(e.error_code){case r.apiErrors.itemRejectedPortfolioRedirect:i[e.error_code].push(e.error_data.userId);break;case r.apiErrors.itemDisabledImageRedirect:case r.apiErrors.itemDisabledVectorRedirect:case r.apiErrors.itemDisabledVideoRedirect:i[e.error_code].push(e.error_data.title);break;case r.apiErrors.itemRejectedDuplicated:i[e.error_code].push(t.makeUrl({id:e.error_data.originalItemId,filename:e.error_data.filename,nudity:0|e.error_data.nudity}))}})),i}})},1072:function(e,t,i){"use strict";var s=i(6);e.exports=s.extend({defaults:{domains:[],countries:[]}})},1074:function(e,t,i){"use strict";var s=i(6);e.exports=s.extend({defaults:{id:null,imageUrl:"",width:null,height:null,type:"",alt:""},parse:function(e){return void 0===e&&(e={}),this.pickDefaultsFrom(e)},isVideo:function(){return"video"===this.get("type")},isCrelloTemplate:function(){return"crelloTemplate"===this.get("type")}})},1094:function(e,t,i){"use strict";var s=i(0),r=i(1142),n=i(1261),a=r.Model.extend({constructor:function(e,t){void 0===t&&(t={}),this.app=t.app||t.collection&&t.collection.app,this.on({request:this.onRequest,sync:this.onSync,error:this.onError}),r.Model.call(this,e,t)},getQueryParams:function(){return s.clone(this.attributes)},exportSettings:function(e){return e?s.pick(this.attributes,e):s.clone(this.attributes)},importSettings:function(){},isBulkAllowed:function(){return!0},clone:function(e){return new this.constructor(this.attributes,e)},onRequest:function(){this.pending=!0},onSync:function(e,t,i){this.pending=!1,t.errors&&this.trigger("error",e,t,i)},onError:function(){this.pending=!1},secureSet:function(e,t,i){if(null===e)return!1;var r,n=i;"object"==typeof e?(r=e,n=t):(r={})[e]=t;var a=s.pick(r,s.intersection(s.keys(r),s.keys(this.attributes)));return!s.isEmpty(a)&&this.set(a,Object.assign(n||{},{validate:!0}))},secureSetParsed:function(e){return this.secureSet(this.parse(e))},resetToDefaults:function(e,t){var i=e?s.pick(this.defaults,e):this.defaults;return this.set(i,t)},getNonDefaults:function(e){var t=this,i=e?s.pick(this.attributes,e):this.attributes,r={};return s.each(i,(function(e,i){s.isEqual(t.defaults[i],e)||(r[i]=e)})),r},hasChangedExcept:function(e){var t=s.isArray(e)?e:[e];return s.size(s.omit(this.hasChanged(),t))>0},serialize:function(){return s.clone(this.attributes)},toAPI:function(){return{}}});Object.assign(a.prototype,n.mixin),e.exports=a},1142:function(e,t,i){"use strict";var s=i(27);s.oldSync=s.oldSync||s.sync,s.sync=function(e,t,i){if(!t.getQueryParams&&!i.getQueryParams||t.oldSync)return s.oldSync.call(this,e,t,i);if(!t.app){if("undefined"==typeof window||!window.app)throw new Error('Model\'s "app" object is not defined');t.app=window.app}return t.app.fetcher.request(e,t,i)},e.exports=s},1217:function(e,t,i){"use strict";var s=i(5).languages.accepts;e.exports={OurApps:function(e){return{isEnabled:e.lang!==s.zh}},About:function(e){return{socialLinksEnabled:e.lang!==s.zh}},FileViewThumb:function(e){return{isSharingEnabled:e.lang!==s.zh}},Share:function(e){return{socialTabEnabled:e.lang!==s.zh}},SearchHeaderFolder:function(e){return{isSharingEnabled:e.user.isLoggedIn()||e.lang!==s.zh}},FileViewModals:function(e){return{shouldHideTitle:e.features.isFeatureOnValue("NoTitleModal")}}}},1219:function(e,t,i){"use strict";var s=i(0),r=i(1094),n=[28,42,56,70];e.exports=r.extend({defaults:{route:"",offset:0,limit:n[0],page:1,totalItems:0,totalPages:0,pagerLimit:1,schema:{}},validation:{offset:{required:!0,pattern:/^[0-9]\d*$/,min:0,fn:function(e){if(e<0||this.get("totalItems")&&e>this.get("totalItems"))return"Invalid value for offset, given: "+e}},page:{required:!0,pattern:/^[1-9]\d*$/,min:1,fn:function(e){if(this.get("totalPages")&&e>this.get("totalPages"))return"Invalid value for page, given: "+e}}},getLimits:function(){return n},getQueryParams:function(){return this.pick(["limit","offset"])},initialize:function(e){var t=e.page,i=e.offset;t?this.mutateOffsetByPage(t):i&&this.mutatePageByOffset(i),this.on("change",this.calculate)},parse:function(e){return s.pick(e,s.keys(this.defaults))},calculate:function(e){s.has(e.changed,"page")&&this.mutateOffsetByPage(e.changed.page),(s.has(e.changed,"offset")||s.has(e.changed,"limit"))&&this.mutatePageByOffset(e.changed.offset),this.attributes.totalPages=Math.ceil(parseFloat(this.get("totalItems")/this.get("limit")))},mutateOffsetByPage:function(e){void 0===e&&(e=this.get("page")),this.attributes.offset=Math.max(parseInt(e,10)-1,0)*this.get("limit")},mutatePageByOffset:function(e){void 0===e&&(e=this.get("offset")),this.attributes.page=Math.floor(parseInt(e/this.get("limit"),10))+1},getSchema:function(){var e=this;if(!s.isEmpty(this.get("schema")))return this.get("schema");var t=function(t){return t<=0||t>e.get("totalPages")?null:e.getUrl({page:t})};return{current:this.getUrl(),buttons:{first:{href:t(this.validation.page.min),page:this.validation.page.min,active:this.get("page")!==this.validation.page.min},last:{href:t(this.get("totalPages")),page:this.get("totalPages"),active:this.get("page")!==this.get("totalPages")},prev:{href:t(this.getPrevPage()),page:this.getPrevPage(),active:this.hasPrevPage()},next:{href:t(this.getNextPage()),page:this.getNextPage(),active:this.hasNextPage()}}}},getUrl:function(e){void 0===e&&(e={});var t=Object.assign(this.getUrlParams(),this.serialize(),e);return this.app.makeUrl(t,this.getUrlQueryParams())},getUrlParams:function(){},getUrlQueryParams:function(){},hasNextPage:function(e){return void 0===e&&(e=this.get("page")),e<this.get("totalPages")},hasPrevPage:function(e){return void 0===e&&(e=this.get("page")),e>this.validation.page.min},getPrevPage:function(){return Math.max(parseInt(this.get("page"),10)-1,1)},getNextPage:function(){return Math.min(parseInt(this.get("page"),10)+1,this.get("totalPages"))},getNextOffset:function(){var e=parseInt(this.get("offset"),10),t=parseInt(this.get("limit"),10);return Math.min(e+t,this.get("totalItems"))}})},1258:function(e,t,i){"use strict";var s=i(0),r=i(1094),n=i(1262),a=r.extend({defaults:{limit:60,offset:0}}),o=i(1219),l=r.extend({});e.exports=n.extend({storageKey:"pageable",endless:!1,pending:!1,byPageCache:{},modeIdToPageLinks:{},lastSyncOptions:{},getQueryParams:function(){var e=s.result(this.filters,"getQueryParams"),t=s.result(this.pager,"getQueryParams"),i=s.result(this.sorting,"getQueryParams");return Object.assign(e,t,i)},initialize:function(e,t){void 0===t&&(t={}),Object.assign(this,s.pick(t,["url","route","endless"])),this.initFilters(t.filters),this.initPager(t.pager),this.initSorting(t.sorting),this.listenTo(this.filters,"change",this.handleFiltersChange),this.listenTo(this.pager,"change",this.handlePagerChange),this.listenTo(this.sorting,"change",this.handleSortingChange),this.on({request:this.onCollectionRequest,sync:this.onCollectionSync,update:this.onCollectionUpdate,reset:this.onCollectionUpdate,sort:this.invalidateCaches})},initFilters:function(e){void 0===e&&(e={}),e.cid?this.filters=e:this.filters=new a(e,{app:this.app})},initPager:function(e){var t=this;void 0===e&&(e={}),e.cid?this.pager=e:(this.endless||s.defaults(e,{limit:s.result(this.app.settings.get(this.storageKey),"limit")}),this.pager=new o(e,{app:this.app}),e&&e.getUrlQueryParams&&(this.pager.getUrlQueryParams=function(){return e.getUrlQueryParams()})),this.pager.getUrlParams=function(){return t.getQueryParams()}},initSorting:function(e){void 0===e&&(e={}),e.cid?this.sorting=e:this.sorting=new l(e,{app:this.app})},fetch:function(e){if(this.pending)return!1;var t=Object.assign({remove:!this.endless,reset:s.result(e,"reset",this.isEmpty()),page:this.pager.get("page")},e);return this.endless&&(t.add=!0),this.endless&&this.pager.get("page")<this.pager.previous("page")&&(t.at=0),n.prototype.fetch.call(this,t)},serializePartial:function(){var e=this;return this.endless&&!s.result(this.lastSyncOptions,"reset")?s.map(this.getCachedPageIds(this.lastSyncOptions.page),(function(t){return e.get(t).serialize()})):n.prototype.serialize.call(this)},handleFiltersChange:function(e,t){var i=s.pick(e.changed,["limit","offset"]);s.isEmpty(i)||this.setPager(i,Object.assign({pageAbleInnerSync:!0},t)),t.pageAbleInnerSync||(this.resetCaches(),this.onFiltersChange(e,t))},handlePagerChange:function(e,t){t.pageAbleInnerSync||!(e.changed.page||e.changed.limit||e.changed.offset)||this.hasCachedPage(e.changed.page)||this.onPagerChange(e,t)},onFiltersChange:function(){},onPagerChange:function(){},handleSortingChange:function(){},onCollectionRequest:function(){this.pending=!0,this.lastSyncOptions={}},onCollectionSync:function(e,t,i){this.pending=!1,this.lastSyncOptions=i},onCollectionUpdate:function(){this.setPager({totalItems:this.totalItems}),this.invalidateCaches()},resetCaches:function(){this.modeIdToPageLinks={},this.byPageCache={}},invalidateCaches:function(){if(this.resetCaches(),this.endless)for(var e=Math.max(this.pager.get("limit"),1),t=0;t<this.models.length;t+=1){var i=Math.ceil((t+1)/e),s=this.models[t];this.modeIdToPageLinks[s.id]=i,this.byPageCache[i]?this.byPageCache[i].push(s.id):this.byPageCache[i]=[s.id]}},hasCachedPage:function(e){var t=this.byPageCache[+e];return t&&t.length===this.pager.get("limit")},getCachedPageIds:function(e){return this.byPageCache[parseInt(e,10)]},getPageByItemId:function(e){return this.modeIdToPageLinks[parseInt(e,10)]},getFilters:function(e){return s.isArray(e)?this.filters.pick(e):this.filters.get(e)},setFilters:function(){var e;return(e=this.filters).secureSet.apply(e,arguments)},getPager:function(e){return s.isArray(e)?this.pager.pick(e):this.pager.get(e)},setPager:function(){var e;return(e=this.pager).secureSet.apply(e,arguments)},getSorting:function(e){return s.isArray(e)?this.sorting.pick(e):this.sorting.get(e)},setSorting:function(){var e;return(e=this.sorting).secureSet.apply(e,arguments)},fetchPage:function(e,t){this.setPager({page:e?parseInt(e,10):this.getPager("page")},t),this.pager.hasChanged()||this.fetch(t)},fetchPrevPage:function(){!this.pending&&this.pager.hasPrevPage()&&this.setPager({page:this.pager.getPrevPage()})},fetchNextPage:function(e){void 0===e&&(e={}),!this.pending&&this.pager.hasNextPage()&&this.setPager({page:this.pager.getNextPage()},Object.assign({},e))}})},1261:function(e,t,i){"use strict";var s=i(162);Object.assign(s.validators,{boolean:function(e,t,i,s){if("boolean"!=typeof e)return this.format("{0} must be boolean",this.formatLabel(t,s))}}),Object.assign(s.patterns,{email:/^(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])$/i}),e.exports=s},1262:function(e,t,i){"use strict";function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e}).apply(this,arguments)}var r=i(1142),n=i(1094);e.exports=r.Collection.extend({model:n,constructor:function(e,t){var i=this;void 0===t&&(t={}),this.app=t.app,this.on("destroy",(function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return i.trigger.apply(i,["sync"].concat(t))})),r.Collection.call(this,e,t)},clone:function(e){return new this.constructor(this.models,{model:this.model,comparator:this.comparator},e)},getQueryParams:function(){return{}},_prepareModel:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var s=r.Collection.prototype._prepareModel.apply(this,t);return s.app=this.app,s},toPLAIN:function(e){return this.models.map((function(t){return t.get(e||t.idAttribute)}))},serialize:function(e){return void 0===e&&(e={}),this.models.map((function(t){return t.serialize(e)}))},toAPI:function(){return{}},isBulkAllowed:function(){return!0},sortByOrder:function(e,t){void 0===e&&(e=[]),void 0===t&&(t={}),this.models.sort((function(t,i){return e.includes(t.id)&&e.includes(i.id)?e.indexOf(t.id)-e.indexOf(i.id):0})),t.silent||this.trigger("sort",this,t)},promiseSync:function(e,t,i){var r=this;return void 0===i&&(i={}),new Promise((function(n,a){r.sync(e,t,s({},i,{success:function(e){return e.errors?a(e.errors):n(e)},error:function(e){a(e)}}))||a(new Error("There is no result returned"))}))}})},1263:function(e,t,i){"use strict";var s=i(1393),r="actionTooltip";e.exports={setActionTooltip:function(){this.setView(r,new s({app:this.app}))},showActionTooltip:function(e){var t=this.getView(r);t&&(t.setTitle(e.currentTarget.dataset.title),t.show(e))},hideActionTooltip:function(){var e=this.getView(r);e&&e.hide()}}},1296:function(e,t,i){"use strict";e.exports.default={suppressScrollX:!0,wheelSpeed:.6,minScrollbarLength:30}},1339:function(e,t,i){},1393:function(e,t,i){"use strict";var s=i(685),r=i(683);e.exports=s.extend({name:"ActionTooltip",params:{type:"simple",rootClose:!0,hideOnScroll:!0,displayForce:!1,displayShowTimeout:0,displayHideTimeout:0,templatePosition:"bm",templatePriority:["bm","lm","auto"],templateOffset:{top:4,left:4},pointerShow:!0},classes:{tooltip_dark:!0},title:"",prepareContent:function(){var e=this;this.content=new r({el:!1,template:function(){return e.title}})},setTitle:function(e){void 0===e&&(e=""),this.title=e}})},1394:function(e,t,i){"use strict";e.exports={initSocialButtons:function(e){var t=this,i=this.app.user.isLoggedIn()?"-"+this.convertBaseNumber(this.app.user.get("id")):"";this.$("._share-button").each((function(s,r){var n=r.getAttribute("data-social"),a=e.shareData.title||r.getAttribute("data-title"),o=e.shareData.description||r.getAttribute("data-description"),l=t.getCustomSocialRedirectUrl({socialSuffix:e.socialNameMap[n],refId:i,element:r});switch(n){case"facebook":r.href=t.app.makeUrl("facebookSharer",{query:{u:l,title:a,description:o,caption:t.app.host,picture:e.shareData.image}});break;case"twitter":r.href=t.app.makeUrl("twitterSharer",{query:{url:l,via:"depositphotos",text:a+" #stock #photo"}});break;case"pinterest":r.href=t.app.makeUrl("pinterestSharer",{query:{url:l,media:e.shareData.image,description:a}});break;case"vk":r.href=t.app.makeUrl("vkSharer",{query:{url:l,title:a,description:o,image:e.shareData.image}});break;default:r.href=""}}))},convertBaseNumber:function(e){return parseInt(e,10).toString(36)},getCustomSocialRedirectUrl:function(e){return this.getSocialRedirectUrl?this.getSocialRedirectUrl(e):this.getDefaultSocialRedirectUrl(e)},getDefaultSocialRedirectUrl:function(e){var t=this.convertBaseNumber(""+e.socialSuffix+this.model.get("id"));return this.app.makeUrl("/v/"+t+e.refId,{absolute:!0})},handleShareButtonClick:function(e){e.preventDefault(),e.stopPropagation();var t=e.currentTarget,i=e.currentTarget.getAttribute("data-width"),s=e.currentTarget.getAttribute("data-height"),r="\n\t\t\ttop="+(screen.height/2-s/2).toFixed(0)+",left="+(screen.width/2-i/2).toFixed(0)+",width="+i+",height="+s+",resizable=yes,\n\t\t\tscrollbars=no,status=yes,location=no";window.open("about:blank",t.getAttribute("data-title"),r).location.href=t.href}}},1395:function(e,t,i){"use strict";i(1808);var s=i(1809),r=i(683),n=i(691);e.exports=r.extend({name:"FolderPermissions",el:!1,template:s,disableRemove:!1,isMultipleSharing:!1,events:{"click ._access":"onAccessClick","click ._remove":"onRemoveClick"},initialize:function(){if(!this.model)throw new Error(this.name+" "+this.cid+": Permission model required!");if(!this.folder)throw new Error(this.name+" "+this.cid+": Folder model required!")},serialize:function(){return{permList:this.isMultipleSharing?this.getListForMultipleSharing():this.getList()}},getListForMultipleSharing:function(){return[{type:"access",name:"view",title:this.tr("Can View"),active:this.folder.hasAction("shareView")},{type:"access",name:"edit",title:this.tr("Can Edit"),active:this.folder.hasAction("shareEdit")}]},getList:function(){var e=this.model.get("type"),t=this.model.get("permission"),i=this.folder.get("permission"),s=this.app.user.get("id")===this.folder.get("userId"),r="user"===this.model.get("type")&&this.model.get("user").get("userId")===this.app.user.get("id"),n=!this.disableRemove&&"link"!==e&&(s||"edit"===i||r),a=[];return this.folder.hasAction("shareEdit")&&(a.push({type:"access",name:"view",title:this.tr("Can View"),active:"view"===t}),a.push({type:"access",name:"edit",title:this.tr("Can Edit"),active:"edit"===t})),n&&a.push({type:"remove",name:"remove",title:r?this.tr("Leave Collection"):this.tr("Remove")}),a},onAccessClick:function(e){e.stopPropagation();var t=e.currentTarget.dataset.name;this.isUserTryToDecreaseOwnAccess(t)?this.showConfirmationDialog(t):this.changeCallback(t)},onRemoveClick:function(e){e.stopPropagation(),this.removeCallback()},isUserTryToDecreaseOwnAccess:function(e){return!this.isMultipleSharing&&("user"===this.model.get("type")&&parseInt(this.model.get("user").get("userId"),10)===parseInt(this.app.user.get("id"),10)&&"edit"===this.model.get("permission")&&"view"===e)},showConfirmationDialog:function(e){var t=this;new n({title:this.tr("Are you sure?"),message:this.tr("By changing sharing settings, you will no longer be able to edit this folder."),footer:[{label:this.tr("Yes"),hide:!0,color:"blue",defaultAction:!0,callback:function(){return t.changeCallback(e)}},{label:this.tr("No"),hide:!0}],destroyOnHide:!0,app:this.app}).show()},changeCallback:function(){},removeCallback:function(){}})},1506:function(e,t,i){"use strict";var s=i(0),r=i(35),n=i(1792);e.exports=r.extend({url:"FolderPermissions",model:n,initialize:function(){var e=this;this.cid=s.uniqueId("col"),this.on("change",(function(t,i){void 0===i&&(i={}),i.observable&&e.app.observer.fire("Favorites:FolderPermissionsChanged",{cid:e.cid,folderId:t.get("folderId")})})),this.on("update",(function(t,i){void 0===i&&(i={}),i.observable&&e.app.observer.fire("Favorites:FolderPermissionsChanged",{cid:e.cid,folderId:t.length?t.first().get("folderId"):0})}))},parse:function(e){return e?e.result:[]},findPermissionByEmail:function(e){return this.find((function(t){return t.isMatchByEmail(e)}))}})},1728:function(e,t,i){"use strict";function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e}).apply(this,arguments)}i(1800);var r=i(1801),n=i(683),a=i(1263);e.exports=n.extend(s({},a,{name:"FolderUsers",el:!1,template:r,maxAvatars:5,events:{"mouseenter ._avatar-box":"onAvatarBoxMouseEnter","mouseleave ._avatar-box":"onAvatarBoxMouseLeave"},initialize:function(){this.listenTo(this.collection,"change update reset",this.render)},prepareRender:function(){return this.users=this.collection.serialize().filter((function(e){return"link"!==e.type})).reverse(),!!this.users.length},serialize:function(){var e=this.users.slice(0,this.maxAvatars);return{users:this.prepareUsers(e),moreCount:this.users.length-e.length,ownerId:this.model.get("userId")}},clientAfterRender:function(){this.setActionTooltip()},prepareUsers:function(e){var t=this;return e.map((function(e){return t.model.get("userId")===e.userId?e.title=t.tr("%s is the owner",e.fullName):"edit"===e.permission?e.title=t.tr("%s can edit",e.fullName):e.title=t.tr("%s can view",e.fullName),e}))},onAvatarBoxMouseEnter:function(e){e.preventDefault(),this.showActionTooltip(e)},onAvatarBoxMouseLeave:function(e){e.preventDefault(),this.hideActionTooltip()}}))},1746:function(e,t,i){"use strict";var s=i(0),r=i(34).defaultFolders,n=i(52),a=i(1793),o=i(1747),l=i(14).stringToKebabCase;e.exports=n.extend({defaults:{id:null,title:"",description:"",count:0,isPublic:!0,isShared:!1,permission:"view",userId:null,userName:"",ownerAvatar:"",ownerApprovedFilesCount:0,coverCropData:{},preferences:[],allowedActions:[],thumbs:[]},relations:{preferences:a,thumbs:o},validation:{count:{pattern:"digits"},isPublic:{boolean:!0}},url:"Folder",lastSyncedAttrs:{},initialize:function(){var e=this;this.on("sync",this.makeKostylCleanUpCoverCropData),this.on("change",(function(t,i){void 0===i&&(i={}),i.observable&&e.app.observer.fire("Favorites:FolderChanged",{id:t.get("id"),cid:t.cid,changed:t.changed,options:i})}))},makeKostylCleanUpCoverCropData:function(e){e.get("preferences").get("coverItemId")&&(e.attributes.coverCropData={})},parse:function(e,t){if(void 0===e&&(e={}),e.errors)return{};t.parser=null;var i=e.lightbox?e.lightbox:e,r=s.pick(i,Object.keys(this.defaults));r.id=parseInt(i.lightboxId,10),r.userId=parseInt(i.userId,10),r.count=parseInt(i.count,10),r.isPublic=i.public,r.thumbs=i.items.filter((function(e){return!s.isEmpty(e)}));var n=this.experimentalTrueParseRelations(r,t);return Object.assign({},r,n)},serialize:function(){var e=this.getFolderTitle(this.attributes.title),t=this.generateLink(),i=this.get("userId")===this.app.user.get("id"),s=n.prototype.serialize.call(this);return Object.assign({},s,{title:e,link:t,isOwn:i})},toJSON:function(){return this.serialize()},generateLink:function(e){var t=this.get("title");return t?(t=l(t),this.app.makeUrl({route:"Folder",folderId:this.get("id"),folderName:t||"folder"},e)):""},getFolderTitle:function(e){return r.some((function(t){return t.label===e}))?this.app.tr(e):e},getQueryParams:function(){return Object.assign({},this.attributes)},savePreference:function(e,t){return this.get("preferences").get(e).set({value:t}),this.save({},{wait:!0})},hasAction:function(e){return this.get("allowedActions").includes(e)}})},1747:function(e,t,i){"use strict";var s=i(983),r=i(35);e.exports=r.extend({url:"Files",model:s,getQueryParams:function(){return{ids:this.pluck("id")}},parse:function(e,t){void 0===t&&(t={}),t.parser=t.parser||"parseFromSearch";var i=e.result||e;return t.trueparse?i.map((function(e){return s.prototype.parse(e,t)})):r.prototype.parse.call(this,i,t)}})},1750:function(e,t,i){"use strict";var s=i(1090);e.exports=s.extend({name:"ShareModal",noBorder:!0,showTitle:!1,destroyOnHide:!0,options:{},modalClasses:"modal_share modal_with-poster",bodyClasses:"modal__body_share",footer:[],initialize:function(){this.options.callback&&(this.onAfterHideCallback=this.options.callback)},hideCallback:function(){this.hide()},shareCallback:function(){this.hide(),this.app.observer.fire("Notification",{type:"success"})}})},1751:function(e,t,i){"use strict";i(1752);var s=i(1217),r=i(1753),n=i(1754),a=i(683),o=i(929),l=i(1394),c=a.extend({name:"Share",el:!1,template:r,props:{},activeTab:"email",events:{"click ._share-button":"handleShareButtonClick"},initialize:function(){if(this.props=s.Share(this.app),!this.model)throw new Error(this.name+" "+this.cid+": Model required!")},prepareRender:function(){var e=this,t=this.getSchema();t.length>1&&this.setViews({"._tabs":new o({schema:t,name:"ShareTabs",template:n,app:this.app,preventDefaultAction:!0,menuUnderline:!0,changeTabCallback:function(){return e.changeTabCallback()}})})},serialize:function(){var e=this.isCompact();return{isCompact:e,title:this.getTitle(),info:e?{}:this.model.serialize(),posterMap:this.getPosterMap(),emailSharingAllowed:this.emailSharingAllowed(),activeTab:this.activeTab}},clientAfterRender:function(){this.isCompact()||this.initSocialButtons({socialNameMap:{facebook:!0,twitter:!0,google:!1},shareData:this.getSocialShareData()})},isCompact:function(){return void 0===this.collection},emailSharingAllowed:function(){return this.app.user.isLoggedIn()},getSchema:function(){var e=[],t=!1;return this.emailSharingAllowed()&&(t=!0,e.push({key:"email",label:this.tr("Email"),active:"email"===this.activeTab})),this.isCompact()||(t=!0,e.push({key:"social",label:this.tr("Social"),active:!t||"social"===this.activeTab,enabled:this.props.socialTabEnabled})),e},getPosterMap:function(){var e=41,t=[],i=[],s=[];if(!this.isCompact()){this.collection.first(6).forEach((function(e){i.push(e.makeThumb("bigWide")),s.push(2*e.get("id").toString().substr(-1))}));for(var r=0;r<Math.max(Math.floor(i.length/2),1);r+=1){var n=e+s[r],a=[{url:i[2*r],width:n}],o=2*r+1;i[o]&&a.push({url:i[o],width:100-n}),t.push({images:a})}}return t},changeTabCallback:function(){this.app.observer.fire("Tooltip:GlobalHide",{cid:"all"});var e=this.findView("ShareTabs").getActiveTab();this.$("._wrap").removeClass("active").filter("[data-tab="+e.get("key")+"]").addClass("active"),this.activeTab=e.get("key")},getSocialRedirectUrl:function(e){return this.app.makeUrl("/f/"+this.model.get("id")+e.refId,{absolute:!0})},shareCallback:function(){}});Object.assign(c.prototype,l),e.exports=c},1752:function(e,t,i){},1753:function(e,t,i){"use strict";e.exports=function(e){var t="undefined"!=typeof _encodeHTML?_encodeHTML:function(e){var t={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},i=/&(?!#?\w+;)|<|>|"|'|\//g;return function(e){return(null==e?"":""+e).replace(i,(function(e){return t[e]||e}))}}(),i='<div class="share-modal';if(e.onlyEmailSharing&&(i+=" share-modal_by-email"),i+='">',!e.isCompact){i+='<div class="share-modal__left"><div class="share-modal__info-box"><span class="share-modal__info-text share-modal__info-text_title">'+t(e.info.title)+'</span><span class="share-modal__info-text share-modal__info-text_count">'+this.tr("%s Files",[e.info.count])+'</span></div><div class="share-modal__poster-wrap share-modal__poster-wrap_rows'+t(e.posterMap.length)+' _poster">';var s=e.posterMap;if(s)for(var r,n=-1,a=s.length-1;n<a;){i+='<div class="share-modal__poster-row share-modal__poster-row_count'+t((r=s[n+=1]).images.length)+'">';var o=r.images;if(o)for(var l,c=-1,d=o.length-1;c<d;)i+='<div class="share-modal__poster-cell"style="width: '+t((l=o[c+=1]).width)+"%;",l.url&&(i+=" background-image: url("+t(l.url)+");"),i+='"></div>';i+="</div>"}i+="</div></div>"}return i+='<div class="share-modal__right"><h2 class="share-modal__title">'+e.title+'</h2><div class="share-modal__tabs _tabs"></div><div class="share-modal__wrap">',e.emailSharingAllowed&&(i+='<div class="share-modal__form',"email"===e.activeTab&&(i+=" active"),i+=' _form _wrap" data-tab="email"></div>'),e.isLinkSharingAllowed&&(i+='<div class="share-modal__link',e.emailSharingAllowed&&"link"!==e.activeTab||(i+=" active"),i+=' _link _wrap" data-tab="link"></div>'),e.isCompact||(i+='<div class="share-modal__social',e.emailSharingAllowed&&"social"!==e.activeTab||(i+=" active"),i+=' _wrap" data-tab="social"><a class="share-modal__social-btn button-share-circle button-share-facebook _share-button"rel="nofollow" data-width="650" data-height="370" data-title="Facebook" data-social="facebook"><span class="button-share-circle-text">Facebook</span></a><a class="share-modal__social-btn button-share-circle button-share-twitter _share-button" rel="nofollow" data-width="730" data-height="420" data-title="Tweet" data-social="twitter"><span class="button-share-circle-text">Twitter</span></a></div>'),i+="</div></div></div>"}},1754:function(e,t,i){"use strict";e.exports=function(e){var t="undefined"!=typeof _encodeHTML?_encodeHTML:function(e){var t={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},i=/&(?!#?\w+;)|<|>|"|'|\//g;return function(e){return(null==e?"":""+e).replace(i,(function(e){return t[e]||e}))}}(),i='<ul class="share-tabs share-tabs_count-'+t(e.scheme.length)+'">',s=e.scheme;if(s)for(var r,n=-1,a=s.length-1;n<a;)(r=s[n+=1]).disabled||(i+='<li class="share-tabs__item',(r.active||r.pseudoActive)&&(i+=" share-tabs__item_active _tab-active"),i+=' _tab" data-key="'+t(r.key)+'"><span class="share-tabs__link">'+t(r.label)+"</span></li>");return i+='<li class="share-tabs__menu-underline hidden _menu-underline"></li></ul>'}},1755:function(e,t,i){"use strict";var s=i(1004),r=i(1296).default,n=i(1807),a=i(689),o=i(683),l=i(1728),c=i(1395),d=i(685);e.exports=o.extend({name:"SharedUsers",el:!1,template:n,listOnly:!1,includeLink:!1,opened:!1,scrollPosition:0,events:{"click ._open-list":"onOpenListClick","click ._close-list":"onCloseListClick","click ._select-perm":"onSelectPermClick"},initialize:function(){if(!this.model)throw new Error(this.name+": Folder model required!");if(!this.collection)throw new Error(this.name+": FolderPermissions collection required!");this.listenTo(this.collection,"change update reset",this.render)},prepareRender:function(){this.setView("._users",new l({app:this.app,model:this.model,collection:this.collection}))},serialize:function(){return{opened:this.opened,listOnly:this.listOnly,includeLink:this.includeLink,linkPermission:this.getLinkPermission(),usersList:this.getUsersList(),ownerId:this.model.get("userId")}},clientAfterRender:function(){var e=this;this.opened&&setTimeout((function(){return e.initPerfectScrollbar()}),0)},initPerfectScrollbar:function(){var e=this.$("._scroll");s.initialize(e.get(0),r),e.scrollTop(this.scrollPosition)},getLinkPermission:function(){var e=this.collection.find((function(e){return"link"===e.get("type")}));return e?e.serialize():{}},getUsersList:function(){return this.opened?this.collection.serialize().filter((function(e){return"link"!==e.type})).reverse():[]},onOpenListClick:function(e){e.preventDefault(),this.opened=!0,this.render()},onCloseListClick:function(e){e.preventDefault(),this.opened=!1,this.render()},onSelectPermClick:function(e){e.stopPropagation();var t=e.currentTarget.dataset.email,i=this.collection.findPermissionByEmail(t),s=this.getView("FolderPermissions");if(this.selectedModel&&this.selectedModel.cid===i.cid)s&&s.toggle(e);else{var r=this.app.user.get("id")===this.model.get("userId"),n="user"===i.get("type")&&i.get("user").get("userId")===this.app.user.get("id");"view"!==this.model.get("permission")||r||n?(this.selectedModel=i,this.setView("FolderPermissions",new d({params:a.FolderPermissions,content:new c({app:this.app,model:i,folder:this.model,changeCallback:this.selectPermissionCallback.bind(this),removeCallback:this.removePermissionCallback.bind(this)})})),this.getView("FolderPermissions").show(e)):s&&s.isOpen()&&s.hide()}},saveScrollPosition:function(){this.scrollPosition=this.$("._scroll").scrollTop()},selectPermissionCallback:function(e){this.getView("FolderPermissions").hide(),this.saveScrollPosition(),this.selectedModel.updatePermission({permission:e})},removePermissionCallback:function(){this.getView("FolderPermissions").hide(),this.saveScrollPosition(),this.selectedModel.deletePermission()}})},1792:function(e,t,i){"use strict";var s=i(0),r=i(6),n=i(52);e.exports=n.extend({url:"FolderPermission",defaults:{type:"",permission:"",folderId:null,link:null,value:null,user:{}},relations:{user:r.extend({defaults:{userId:null,username:"",email:"",firstName:"",lastName:"",avatar:"/_img/avatar-border-default-30.png"},initialize:function(){var e=this;this.on("change:userId",(function(){e.attributes.userId=parseInt(e.attributes.userId,10)}))},parse:function(e){void 0===e&&(e={});var t=s.pick(e,Object.keys(this.defaults));return t.userId=parseInt(t.userId,10),t}})},parse:function(e){if(void 0===e&&(e={}),e.errors)return{};var t=s.pick(e,Object.keys(this.defaults));return t.folderId=parseInt(t.folderId,10)||this.defaults.folderId,t.link=e.link||null,"email"===t.type&&(t.user={email:e.value}),"user"===t.type&&(t.user=e.value),t},getQueryParams:function(){var e=Object.assign({emitter:this.app.uid},this.attributes,this.get("user").attributes);return"link"===this.get("type")&&(e.id=this.get("value")),"user"===this.get("type")&&(e.id=this.get("user").get("userId")),e.type="link"===e.type?e.type:"user",e},serialize:function(){return Object.assign(this.get("user").serialize(),{userId:parseInt(this.get("user").get("userId"),10),permission:this.get("permission"),type:this.get("type"),link:this.get("link"),fullName:this.getFullName()})},getFullName:function(){return this.get("user").get("firstName").length?(this.get("user").get("firstName")+" "+(this.get("user").get("lastName")||"")).trim():this.get("user").get("email")},isMatchByEmail:function(e){return"link"!==this.get("type")&&this.get("user").get("email")===e},updatePermission:function(e){return this.save(e,{wait:!0,observable:!0})},deletePermission:function(){var e=this;return this.sync("delete",this,{success:function(){return e.destroy({observable:!0})}})}})},1793:function(e,t,i){"use strict";var s=i(0),r=i(6),n=i(35),a=r.extend({defaults:{name:"",label:"",value:null,editable:!0,selector:""},idAttribute:"name",lastSyncedAttrs:{},initialize:function(){var e=this;this.fakeNestedSaveLastSyncedAttrs(),this.on("change",(function(t,i){i.storeAsLastSynced&&e.fakeNestedSaveLastSyncedAttrs()}))},saveLastSyncedAttrs:function(e,t){t.errors||(this.lastSyncedAttrs=Object.assign({},this.lastSyncedAttrs,this.attributes))},resetToLastSynced:function(e,t){return this.set(e?s.pick(this.lastSyncedAttrs,e):this.attributes,t)},isChangedButNotSaved:function(e){return this.get(e)!==this.lastSyncedAttrs[e]},isChangedButNotSavedValue:function(){return this.isChangedButNotSaved("value")},resetToLastSyncedValue:function(){return this.resetToLastSynced("value")},fakeNestedSaveLastSyncedAttrs:function(){this.saveLastSyncedAttrs({},{})}});e.exports=n.extend({model:a,getPrefsAsHash:function(){var e=this.serialize(),t={};return e.forEach((function(e){t[e.name]=e.value})),t}})},1800:function(e,t,i){},1801:function(e,t,i){"use strict";e.exports=function(e){var t="undefined"!=typeof _encodeHTML?_encodeHTML:function(e){var t={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},i=/&(?!#?\w+;)|<|>|"|'|\//g;return function(e){return(null==e?"":""+e).replace(i,(function(e){return t[e]||e}))}}(),i='<div class="folder-users"><div class="folder-users__avatars">',s=e.users;if(s)for(var r,n=-1,a=s.length-1;n<a;)i+='<div class="folder-users__avatar _avatar-box" data-title="'+t((r=s[n+=1]).title)+'">',"email"===r.type?i+='<span class="shared-users__link-box"><i class="icon icon-sharing-email"></i></span>':i+='<span class="folder-users__avatar-box avatar-box avatar-box-m"><img class="folder-users__avatar-img avatar avatar-m" src="'+r.avatar+'" /></span>',r.userId===e.ownerId&&(i+='<i class="folder-users__star icon icon-star-owner"></i>'),i+="</div>";return i+="</div>",e.moreCount>0&&(i+='<div class="folder-users__more">+'+t(e.moreCount)+"</div>"),i+="</div>"}},1802:function(e,t,i){"use strict";var s=i(1750),r=i(1803);e.exports=s.extend({name:"ShareFolder",body:function(){return new r({app:this.app,model:this.model,collection:this.collection,permissions:this.permissions,asyncPermissionsLoad:this.asyncPermissionsLoad,shareCallback:this.shareCallback.bind(this),hideCallback:this.hideCallback.bind(this)})}})},1803:function(e,t,i){"use strict";function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e}).apply(this,arguments)}var r=i(1751),n=i(1506),a=i(1804),o=i(1817);e.exports=r.extend({name:"ShareFolder",asyncPermissionsLoad:!1,initialize:function(){if(r.prototype.initialize.call(this),!this.asyncPermissionsLoad&&!this.permissions)throw new Error(this.name+" "+this.cid+": FolderPermissions collection required!");!this.isMultipleSharing()&&this.asyncPermissionsLoad&&(this.permissions=new n([],{app:this.app}),this.permissions.getQueryParams={folderId:this.model.get("id")},this.permissions.fetch({reset:!0}))},prepareRender:function(){this.setTabActive(),r.prototype.prepareRender.call(this);var e=this.isCompact()&&!this.linkSharingAllowed(),t={"._form":new a({app:this.app,folder:this.model,permissions:this.permissions,isMultipleSharing:this.isMultipleSharing(),shouldShowTitle:!e,shareCallback:this.shareCallback.bind(this)})};!this.isMultipleSharing()&&this.emailSharingAllowed()&&(t["._link"]=new o({app:this.app,folder:this.model,permissions:this.permissions,hideCallback:this.hideCallback.bind(this)})),this.setViews(t)},serialize:function(){var e=this.linkSharingAllowed();return s({},r.prototype.serialize.call(this),{isLinkSharingAllowed:e,onlyEmailSharing:this.isCompact()&&!e})},getTitle:function(){return this.isMultipleSharing()?this.tr("Share Collections"):this.tr("Share Collection")},isMultipleSharing:function(){return this.model instanceof Array&&this.model.length>1},linkSharingAllowed:function(){return!this.isMultipleSharing()&&"edit"===this.model.get("permission")&&this.app.user.isLoggedIn()},getSocialShareData:function(){return{title:this.model.get("title"),description:this.model.get("description"),image:this.collection.length?this.collection.first().makeThumb("huge"):""}},setTabActive:function(){if(this.permissions){var e=this.permissions.findWhere({type:"link"});this.permissions.where({type:"user"}).length<=1&&e&&"edit"===e.get("permission")&&(this.activeTab="link")}},getSchema:function(){var e=[].concat(r.prototype.getSchema.call(this));return this.linkSharingAllowed()&&e.splice(1,0,{key:"link",label:this.tr("Link"),active:"link"===this.activeTab}),e}})},1804:function(e,t,i){"use strict";i(1805);var s=i(0),r=i(689),n=i(1806),a=i(752),o=i(754),l=i(1755),c=i(1395),d=i(685),u=i(1810),h=i(1811),p=i(1816),f=[a.space,a.enter,a.semicolon,a.comma],g=[";"],m=[a.space,a.semicolon,a.comma];e.exports=o.extend({name:"ShareFolderForm",el:!1,template:n,isMultipleSharing:!1,shouldShowTitle:!0,events:Object.assign({},o.prototype.events,{"click ._add-perm":"onAddPermClick"}),initialize:function(){this.model=new u({foldersID:this.getSharingIds(),maxEmails:20},{app:this.app}),this.shareEmailsCollection=new p([],{app:this.app}),this.listenTo(this.model,{invalid:this.showErrors,sync:this.onSubmitForm,"change:permission":this.render})},prepareRender:function(){!this.isMultipleSharing&&this.canSetPermission()&&this.setView("._shared",new l({app:this.app,model:this.folder,collection:this.permissions})),this.setMultiInput()},setMultiInput:function(){var e=this,t=function(t){return e.fieldReset(e.$(t.currentTarget).closest("._errorHolder"))};this.setView("._share-multiple-emails",new h({app:this.app,collection:this.shareEmailsCollection,parseRecieverData:function(t){return e.parseEmails(t)},onItemDeleteCallback:t,onItemFocusCallback:t,onItemBlurCallback:t,onReceiverFocusCallback:t,onReceiverBlurCallback:t,receiverCreateKeyCodes:f,receiverCreateKeys:g,itemEditExcludedKeys:m}))},serialize:function(){return{formData:this.model.serialize(),canShareForEdit:this.canShareForEdit(),canSetPermission:this.canSetPermission(),permissionLabel:this.getPermissionLabel(),permissionType:this.model.get("permission"),shouldShowTitle:this.shouldShowTitle}},clientAfterRender:function(){this.canSetPermission()&&this.setView("AddFolderPermissions",new d({params:r.FolderPermissions,content:new c({app:this.app,model:this.model,folder:this.folder,disableRemove:!0,isMultipleSharing:this.isMultipleSharing,changeCallback:this.selectPermissionCallback.bind(this)})}))},getSharingIds:function(){return this.isMultipleSharing?this.folder.map((function(e){return e.get("id")})):this.folder.get("id")},canSetPermission:function(){return this.isMultipleSharing?this.folder.every((function(e){return"edit"===e.get("permission")})):"edit"===this.folder.get("permission")},canShareForEdit:function(){return this.isMultipleSharing?this.folder.every((function(e){return e.hasAction("shareEdit")})):this.folder.hasAction("shareEdit")},getPermissionLabel:function(){return"edit"===this.model.get("permission")?this.tr("Can Edit"):this.tr("Can View")},onFieldFocusOut:function(e){if(e.currentTarget.value.length){var t="email"===e.currentTarget.name?this.$(e.currentTarget).closest("._errorHolder"):this.$(e.currentTarget).parent();this.fieldCorrect(t)}},onSubmitForm:function(e,t){t&&t.errors instanceof Array&&this.showSubmitError(t.errors[0].error_message)},onAddPermClick:function(e){e.preventDefault(),this.getView("AddFolderPermissions").toggle(e)},showErrors:function(e,t){var i=this;void 0===t&&(t={}),this.$("label:not(.field-box_correct) input, label:not(.field-box_correct) textarea").each((function(e){return i.fieldReset(i.$(e).parent())})),Object.keys(t).forEach((function(e){var s=t[e]instanceof Array?t[e][0]:t[e],r="emails"===e?i.$("._errorHolder"):i.$("input[name="+e+"], textarea[name="+e+"]").parent();i.fieldIncorrect(r,{errorMessage:s.length?i.tr(s):s})}))},showSubmitError:function(e){if(e){var t=this.$("._submit-error");t.toggleClass("hidden",!1),t.text(e)}},serializeForm:function(){return{emails:this.getEmailsArray(),subject:this.$el.find("._share-subject").val()}},parseEmails:function(e){return s.uniq(s.compact(e.split(/[\s,;]+/))).map((function(e){return{value:e}}))},getEmailsArray:function(){return s.pluck(this.shareEmailsCollection.serialize(),"value")},prepareSubmit:function(){this.model.set({emails:this.getEmailsArray()})},submit:function(){var e=this;this.model.save(this.serializeForm(),{wait:!0,success:function(){e.app.observer.fire("Favorites:FolderPermissionsChanged",{cid:"all",folderId:e.getSharingIds()}),e.shareCallback()}})},selectPermissionCallback:function(e){this.getView("AddFolderPermissions").hide(),this.model.set({permission:e})},shareCallback:function(){}})},1805:function(e,t,i){},1806:function(e,t,i){"use strict";e.exports=function(e){var t='<form class="share-email">';return e.shouldShowTitle&&(t+='<span class="share-email__title">'+this.tr("Invite people to collaborate via Email")+":</span>"),t+='<div class="share-email__field field-box input-box input-box-xxxl input-box-params',e.canShareForEdit||(t+=" share-email__field_no-perms"),t+=' _errorHolder"><div class="input-params-wrap"><span class="input-params-title">'+this.tr("To:")+'</span><div class="_emails-counter share-modal__emails-counter-box"></div><div class="multi-input-box _share-multiple-emails"></div><div class="cmp-option-select input-params-select"><div class="cmp-option-select-wrap _add-perm">',"view"===e.permissionType&&(t+='<i class="icon-folder-action-view cmp-option-select-icon"></i>'),"edit"===e.permissionType&&(t+='<i class="icon-folder-action-edit cmp-option-select-icon"></i>'),t+='<i class="cmp-option-select-arrow arrow arrow-bottom arrow-block-1"></i></div></div></div></div><div class="share-email__shared _shared"></div><button class="share-email__submit button button-xxl button-watery button-blue _submit" type="submit">'+this.tr("Share")+"</button></form>"}},1807:function(e,t,i){"use strict";e.exports=function(e){var t="undefined"!=typeof _encodeHTML?_encodeHTML:function(e){var t={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},i=/&(?!#?\w+;)|<|>|"|'|\//g;return function(e){return(null==e?"":""+e).replace(i,(function(e){return t[e]||e}))}}(),i='<div class="shared-users';if(e.opened&&(i+=" shared-users_opened"),e.listOnly&&(i+=" shared-users_list-only"),i+='">',e.listOnly||(i+='<span class="shared-users__title">'+this.tr("Shared with:")+"</span>"),e.opened){e.listOnly||(i+='<i class="shared-users__close arrow arrow-top arrow-block-1 _close-list"></i>'),i+='<div class="shared-users__list-box _scroll"><ul class="shared-users__list">',e.includeLink&&(i+='<li class="shared-users__list-row shared-users__list-row_type"><div class="shared-users__user"><div class="shared-users__avatar"><span class="shared-users__link-box"><i class="icon icon-sharing-link"></i></span></div><span class="shared-users__user-email">'+this.tr("Link Sharing")+'</span><span class="shared-users__user-name">',"edit"===e.linkPermission.permission?i+=""+this.tr("Anyone with the link can edit"):i+=""+this.tr("Anyone with the link can view"),i+='</span></div><div class="shared-users__perm">',"edit"===e.linkPermission.permission?i+='<i class="icon icon-folder-action-edit"></i>':i+='<i class="icon icon-folder-action-view"></i>',i+="</div></li>");var s=e.usersList;if(s)for(var r,n=-1,a=s.length-1;n<a;)(r=s[n+=1]).userId===e.ownerId?(i+='<li class="shared-users__list-row"><div class="shared-users__user"><div class="shared-users__avatar"><span class="shared-users__avatar-box avatar-box avatar-box-m"><img class="shared-users__avatar-img avatar avatar-m" src="'+r.avatar+'" /></span>',r.userId===e.ownerId&&(i+='<i class="shared-users__star icon icon-star-owner"></i>'),i+='</div><span class="shared-users__user-name">',r.firstName.length||r.lastName.length?i+=t(r.firstName)+" "+t(r.lastName):i+=""+t(r.username),i+='</span><span class="shared-users__user-email" title="'+t(r.email)+'">'+t(r.email)+'</span></div><div class="shared-users__perm"><span class="shared-users__creator">'+this.tr("Creator")+"</span></div></li>"):(i+='<li class="shared-users__list-row shared-users__list-row_hoverable _select-perm"data-id="'+t(r.email)+'"data-email="'+t(r.email)+'"><div class="shared-users__user">',"email"===r.type?i+='<div class="shared-users__avatar"><span class="shared-users__link-box"><i class="icon icon-sharing-email"></i></span></div>':(i+='<div class="shared-users__avatar"><span class="shared-users__avatar-box avatar-box avatar-box-m"><img class="shared-users__avatar-img avatar avatar-m" src="'+r.avatar+'" /></span>',r.userId===e.ownerId&&(i+='<i class="shared-users__star icon icon-star-owner"></i>'),i+="</div>"),i+='<span class="shared-users__user-name">',r.firstName.length||r.lastName.length?i+=t(r.firstName)+" "+t(r.lastName):i+=""+t(r.username),i+='</span><span class="shared-users__user-email" title="'+t(r.email)+'">'+t(r.email)+'</span></div><div class="shared-users__perm">',"edit"===r.permission?i+='<i class="icon icon-folder-action-edit"></i>':i+='<i class="icon icon-folder-action-view"></i>',i+="</div></li>");i+="</ul></div>"}else i+='<div class="shared-users__avatars _users _open-list"></div><i class="shared-users__icon arrow arrow-bottom arrow-block-1 _open-list"></i>';return i+="</div>"}},1808:function(e,t,i){},1809:function(e,t,i){"use strict";e.exports=function(e){var t="undefined"!=typeof _encodeHTML?_encodeHTML:function(e){var t={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},i=/&(?!#?\w+;)|<|>|"|'|\//g;return function(e){return(null==e?"":""+e).replace(i,(function(e){return t[e]||e}))}}(),i='<ul class="folder-perm-tooltip">',s=e.permList;if(s)for(var r,n=-1,a=s.length-1;n<a;)i+='<li class="folder-perm-tooltip__item folder-perm-tooltip__item_'+t((r=s[n+=1]).type)+" _"+t(r.type)+'" data-name="'+t(r.name)+'">',r.active&&(i+='<i class="folder-perm-tooltip__icon icon icon-ok"></i>'),i+='<span class="folder-perm-tooltip__title">'+t(r.title)+"</span></li>";return i+="</ul>"}},1810:function(e,t,i){"use strict";var s=i(34).validationMessages,r=i(0),n=i(6);e.exports=n.extend({url:"ShareFolder",defaults:{folderID:null,rawEmails:"",emails:[],subject:"",type:"email",permission:"view",maxEmails:65535},validation:{emails:function(e){var t=this;if(!e.length)return!0;if(e.length>this.get("maxEmails"))return this.app.translator.tr(this.getValidationMessage("tooMuchEmails"),[this.get("maxEmails")]);var i=null;return e.find((function(e){return e.length<3?(i=t.getValidationMessage("emailMin"),!0):e.length>128?(i=t.getValidationMessage("emailMax"),!0):!t.isEmail(e)&&(i=t.getValidationMessage("multipleEmail"),!0)})),i},permission:{oneOf:["view","edit"]},type:{oneOf:["user","email"]}},isEmail:function(e){return/^(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])$/i.test(e)},getValidationMessage:function(e){return s.find((function(t){return t.key===e})).label},parse:function(e){return r.pick(e,r.keys(this.defaults))},getQueryParams:function(){return Object.assign({},this.attributes,{type:"user"})}})},1811:function(e,t,i){"use strict";i(1812);var s=i(1004),r=i(1296).default,n=i(1813),a=i(752),o=i(683),l=i(1814);e.exports=o.extend({name:"MultiInput",el:!1,template:n,isReceiverInFocus:!1,receiverCreateKeyCodes:[a.enter],receiverCreateKeys:[],itemEditExcludedKeys:[],events:{"focus ._multi-input-receiver":"onReceiverFocus","blur ._multi-input-receiver":"onReceiverBlur","keydown ._multi-input-receiver":"onReceiverKeyDown","input ._multi-input-receiver":"onReceiverInput","mousedown ._multi-input-content":"onMultiInputMousedown","click ._multi-input-content":"onMultiInputClick"},prepareRender:function(){this.setViews({"._items-list":new l({collection:this.collection,onItemChangeCallback:this.onItemChangeCallback.bind(this),onItemDeleteCallback:this.onItemDeleteCallback.bind(this),onItemFocusCallback:this.onItemFocusCallback.bind(this),onItemBlurCallback:this.onItemBlurCallback.bind(this),setReceiverFocus:this.setReceiverFocus.bind(this),addedAfterRender:this.itemsAfterAddCallback.bind(this),removedAfterRender:this.itemsAfterRemoveCallback.bind(this),excludedKeys:this.itemEditExcludedKeys})})},clientAfterRender:function(){this.perfectScrollbar=s,this.perfectScrollbar.initialize(this.$("._scroll").get(0),r)},onMultiInputMousedown:function(e){e.currentTarget===e.target&&(e.preventDefault(),e.stopPropagation())},onMultiInputClick:function(e){this.isReceiverInFocus||e.currentTarget===e.target&&this.setReceiverFocus()},onReceiverInput:function(e){var t=this.$("._multi-input-receiver-meter");t.text(e.currentTarget.value),t.outerWidth()>0?this.$(e.currentTarget).outerWidth(t.outerWidth()+3).outerHeight(t.outerHeight()):this.$(e.currentTarget).removeAttr("style"),this.updateScrollbar()},onReceiverKeyDown:function(e){this.createItemTriggered(e)&&this.createItems(e),e.keyCode===a.tab&&this.onReceiverTabPress(e)},createItemTriggered:function(e){return this.receiverCreateKeyCodes.some((function(t){return t===e.keyCode}))||this.receiverCreateKeys.some((function(t){return t===e.key}))},createItems:function(e){e.preventDefault(),this.saveReceiverData(e),this.resetReceiver()},onReceiverTabPress:function(e){this.getReceiverData()&&(e.preventDefault(),this.saveReceiverData(e),this.resetReceiver())},onReceiverFocus:function(e){this.isReceiverInFocus=!0,this.onReceiverFocusCallback(e)},onReceiverBlur:function(e){this.isReceiverInFocus=!1,this.saveReceiverData(e),this.resetReceiver(),this.onReceiverBlurCallback(e)},saveReceiverData:function(e){var t=this.getReceiverData();t&&this.addNewItemsToCollection(t)},resetReceiver:function(){var e=this.getReceiver();e.setAttribute("style",""),e.value="",this.$("._multi-input-receiver-meter").html("")},setReceiverFocus:function(){this.getReceiver().focus()},getReceiver:function(){return this.$("._multi-input-receiver")[0]},getReceiverData:function(){var e=this.getReceiver().value;return""!==e&&this.parseRecieverData(e)},parseRecieverData:function(e){return[{value:e}]},addNewItemsToCollection:function(e){void 0===e&&(e=[]);var t=this.prepareItems(e);t.length?this.collection.add(t):(this.resetReceiver(),this.scrollToReciever())},prepareItems:function(e){var t=this;return e.filter((function(e){return!t.collection.some((function(t){return t.get("value")===e.value}))}))},onItemDeleteCallback:function(){},onItemFocusCallback:function(){},onItemBlurCallback:function(){},onReceiverFocusCallback:function(){},onReceiverBlurCallback:function(){},itemsAfterAddCallback:function(){this.scrollToReciever()},itemsAfterRemoveCallback:function(){this.updateScrollbar()},onItemChangeCallback:function(){this.updateScrollbar()},scrollToReciever:function(){this.updateScrollbar(),this.$("._scroll").scrollTop(65535)},updateScrollbar:function(){s.update(this.$("._scroll").get(0))}})},1812:function(e,t,i){},1813:function(e,t,i){"use strict";e.exports=function(e){return'<div class="multi-input"><div class="multi-input__content-wrapper _scroll"><div class="multi-input__content _multi-input-content"><span class="multi-input__receiver-meter _multi-input-receiver-meter"></span><div class="_items-list"></div><div class="_multi-input-receiver-box"><textarea class="multi-input__receiver _multi-input-receiver" type="text" autocomplete="off" placeholder="'+("undefined"!=typeof _encodeHTML?_encodeHTML:function(e){var t={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},i=/&(?!#?\w+;)|<|>|"|'|\//g;return function(e){return(null==e?"":""+e).replace(i,(function(e){return t[e]||e}))}}())(this.tr("Email"))+'"></textarea></div></div></div></div>'}},1814:function(e,t,i){"use strict";var s=i(689),r=i(752),n=i(1815),a=i(683),o=i(685);e.exports=a.extend({name:"MultiInputItem",el:!1,template:n,excludedKeys:[],addedAfterRenderNeeded:!1,removedAfterRenderNeeded:!1,events:{"focus ._item-text":"onItemFocus","blur ._item-text":"onItemBlur","keydown ._item-text":"onItemtKeyDown","input ._item-text":"onItemtInput","mousedown ._item-delete":"onDeleteMouseDown","click ._item-delete":"onDeleteClick","mouseenter ._item-invalid":"showValidationTip","mouseleave ._item-invalid":"hideValidationTip"},initialize:function(){this.listenTo(this.collection,"update reset",(function(e,t){var i=t.changes,s=i.added,r=i.removed;this.addedAfterRenderNeeded=!!s.length,this.removedAfterRenderNeeded=!!r.length,this.render()})),this.listenTo(this.collection,"change",this.onItemChangeCallback)},serialize:function(){return{items:this.collection.serialize()}},clientAfterRender:function(){this.setValidationTip(),this.addedAfterRenderNeeded&&this.addedAfterRender(),this.removedAfterRenderNeeded&&this.removedAfterRender(),this.restoreFocus()},setValidationTip:function(){this.setNotExistView("validationTip",o,{params:s.multiInputValidationTip,content:new a({el:!1,template:function(){return""}})})},showValidationTip:function(e){var t=e.currentTarget.dataset.id,i=this.collection.get(t).validationMessage,s=void 0===i?"":i;this.getView("validationTip").content.template=function(){return s},this.getView("validationTip").show(e)},hideValidationTip:function(){this.getView("validationTip").hide()},onItemtKeyDown:function(e){e.keyCode===r.enter&&this.onItemEnterPress(e),this.excludedKeys.some((function(t){return t===e.keyCode}))&&e.preventDefault(),e.keyCode===r.tab&&this.onItemtTabPress(e)},onItemtInput:function(e){this.streamChangesToModel(e)},streamChangesToModel:function(e){var t=this.$(e.currentTarget).closest("._item"),i=t.attr("data-id"),s=this.collection.get(i),r=this.$(e.currentTarget).html();s.set({value:r}),s.validate(),s.isValid()&&this.getView("validationTip").hide(),t.toggleClass("_item-invalid multi-input-item_invalid",!s.isValid())},onItemEnterPress:function(e){e.preventDefault(),this.itemInputAction(e),this.setReceiverFocus()},onItemtTabPress:function(e){""===this.$(e.currentTarget).html()&&(this.focusStats={itemIndex:this.$(e.currentTarget).closest("._item").index(),cursorMoveDirection:e.shiftKey?"back":"forward"})},restoreFocus:function(){if(this.focusStats){var e=this.focusStats,t=e.itemIndex,i="forward"===e.cursorMoveDirection?t:t-1;this.$("._item").eq(i).find("._item-text").focus(),this.focusStats=null}},onItemFocus:function(e){this.onItemFocusCallback(e)},onItemBlur:function(e){this.itemInputAction(e),this.onItemBlurCallback(e)},itemInputAction:function(e){var t=this.$(e.currentTarget),i=t.html(),s=t.closest("._item").attr("data-id");""!==i?this.changeItemInCollection(s,{value:i}):this.removeItemInCollection(s)},onDeleteMouseDown:function(e){e.preventDefault()},onDeleteClick:function(e){e.preventDefault(),this.deleteItem(e)},deleteItem:function(e){var t=this.$(e.currentTarget).closest("._item").attr("data-id");this.removeItemInCollection(t),this.hideValidationTip(),this.onItemDeleteCallback(e)},changeItemInCollection:function(e,t){void 0===t&&(t={}),this.collection.get(e).set(t)},removeItemInCollection:function(e){this.collection.remove(e)},onItemDeleteCallback:function(){},onItemChangeCallback:function(){},onItemFocusCallback:function(){},onItemBlurCallback:function(){},addedAfterRender:function(){},removedAfterRender:function(){}})},1815:function(e,t,i){"use strict";e.exports=function(e){var t="undefined"!=typeof _encodeHTML?_encodeHTML:function(e){var t={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},i=/&(?!#?\w+;)|<|>|"|'|\//g;return function(e){return(null==e?"":""+e).replace(i,(function(e){return t[e]||e}))}}(),i="<div>",s=e.items;if(s)for(var r,n=-1,a=s.length-1;n<a;)i+='<span class="multi-input-item _item',!1===(r=s[n+=1]).isValid&&(i+=" multi-input-item_invalid _item-invalid"),i+='" data-id="'+t(r.id)+'"><span class="multi-input-item__text _item-text" contenteditable="true">'+t(r.value)+'</span><i class="multi-input-item__delete _item-delete"></i></span>';return i+="</div>"}},1816:function(e,t,i){"use strict";var s=i(34).validationMessages,r=i(6),n=i(35);e.exports=n.extend({model:r.extend({defaults:{value:""},initialize:function(){var e=this;this.on("add",(function(t,i,s){var r=e.validate();r&&(t.validationMessage=e.getValidationMessage(r))}))},validation:{value:[{required:!0,msg:s.find((function(e){return"required"===e.key})).label},{minLength:3,msg:s.find((function(e){return"emailMin"===e.key})).label},{maxLength:128,msg:s.find((function(e){return"emailMax"===e.key})).label},{pattern:"email",msg:s.find((function(e){return"email"===e.key})).label}]},serialize:function(){return Object.assign({},this.attributes,{id:this.cid,isValid:this.isValid()})},getValidationMessage:function(e){return e&&e.value||null}})})},1817:function(e,t,i){"use strict";var s=i(689),r=i(1818),n=i(754),a=i(1395),o=i(685);e.exports=n.extend({name:"ShareLinkForm",el:!1,template:r,events:Object.assign({},n.prototype.events,{"click ._done":"onDoneClick","click ._add-perm":"onAddPermClick","click ._link-field":"onLinkFieldClick","click ._link-copy":"onLinkCopyClick"}),initialize:function(){var e=this;this.listenTo(this.permissions,{"change:permission":function(t){"link"===t.get("type")&&e.render()},update:this.render,reset:this.render})},prepareRender:function(){return this.model=this.permissions.findWhere({type:"link"}),void 0!==this.model},serialize:function(){return{canShareForEdit:this.canShareForEdit(),sharedLink:this.getSharedLink(),permissionLabel:this.getPermissionLabel()}},clientAfterRender:function(){this.model&&this.setView("AddFolderPermissions",new o({params:s.FolderPermissions,content:new a({app:this.app,model:this.model,folder:this.folder,changeCallback:this.selectPermissionCallback.bind(this)})}))},canShareForEdit:function(){return this.folder.hasAction("shareEdit")},getPermissionLabel:function(){return"edit"===this.model.get("permission")?this.tr("Can Edit"):this.tr("Can View")},onDoneClick:function(){this.hideCallback()},onAddPermClick:function(e){e.preventDefault(),this.getView("AddFolderPermissions").toggle(e)},onLinkFieldClick:function(e){e.currentTarget.select()},onLinkCopyClick:function(){var e=this.$("._link-field").get(0);e.select();try{document.execCommand("copy")&&this.app.observer.fire("Notification",{type:"success",description:this.tr("Link copied to the clipboard.")})}catch(e){}e.selectionStart=-1,e.selectionEnd=-1},getSharedLink:function(){return this.model.get("link")||this.app.makeUrl({route:"Folder",folderId:this.folder.get("id"),folderName:this.folder.get("title")},{absolute:!0})},selectPermissionCallback:function(e){this.model.updatePermission({permission:e}),this.getView("AddFolderPermissions").hide()},hideCallback:function(){}})},1818:function(e,t,i){"use strict";e.exports=function(e){var t="undefined"!=typeof _encodeHTML?_encodeHTML:function(e){var t={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},i=/&(?!#?\w+;)|<|>|"|'|\//g;return function(e){return(null==e?"":""+e).replace(i,(function(e){return t[e]||e}))}}(),i='<form class="share-link';return e.canShareForEdit||(i+=" share-link__no-perms"),i+='"><form class="share-link"><span class="share-link__title">'+this.tr("Collaborate by sharing link")+':</span><div class="share-link__field field-box input-box input-box-xxxl input-box-params"><div class="input-params-wrap"><input class="input input-xxxl _link-field" type="text" name="link" value="'+t(e.sharedLink)+'" autocomplete="off" readonly /><div class="input-params-select"><span class="input-action-wrap _link-copy"><span class="input-action">'+this.tr("Copy link")+'</span></span></div></div></div><div class="share-link__perm"><div class="share-link__perm-title">'+this.tr("Users with the link")+':</div><div class="cmp-option-select share-link__perm-select"><div class="cmp-option-select-wrap _add-perm"><span class="cmp-option-select-value">'+t(e.permissionLabel)+'</span><i class="cmp-option-select-arrow arrow arrow-bottom arrow-block-1"></i></div></div></div><button class="share-link__done button button-xxl button-watery button-blue _done">'+this.tr("Done")+"</button></form>"}},1926:function(e,t,i){"use strict";(function(e){i(2298);var t=i(689),s=i(979).spinner,r=i(2299),n=i(980),a=i(683),o=i(685),l=i(14).safeChain,c=i(2300),d=i(2067),u=(0,i(11).getLogger)(e);e.exports=a.extend({name:"FoldersSelect",el:!1,template:r,selectableGroup:!1,excludeActive:!1,onlyEditable:!1,containersOnly:!1,selected:null,events:{click:"onClick"},initialize:function(){this.listenTo(this.activeFolder,{destroy:this.handleFoldersRemove,sync:this.handleFoldersSync,"change:count":this.handleFoldersSync,"change:id":this.render}),this.listenTo(this.folders,{remove:this.handleFoldersRemove,sync:this.handleFoldersSync,add:this.handleFoldersAdd}),this.listenTo(this.app.observer,{"Favorites:RemoteFolderChanged":this.handleRemoteFolderChanged});var e={page:1,limit:100};this.ownFolders=new d([],{app:this.app,endless:!0,filters:{permission:["owner"]},pager:e}),this.sharedFolders=new d([],{app:this.app,endless:!0,filters:{permission:this.onlyEditable?["edit"]:["edit","view"]},pager:e}),this.fetchFolders(!0)},serialize:function(){var e=this.getSelectedFolder(),t={title:this.tr(this.app.user.isLoggedIn()?"My Folders":"My Photos"),isShownCounter:this.app.user.isLoggedIn()};if(this.state&&this.state.isEmptyFoldersMode()||!this.app.user.isLoggedIn())return{emptyFolder:t,className:this.className,containersOnly:this.containersOnly};if(this.state&&!this.state.isFilesMode()){var i="owner"===this.state.get("folderID"),s=i?this.ownFolders.getPager("totalItems"):this.sharedFolders.getPager("totalItems");return{emptyFolder:t,className:this.className,folder:{isOwn:i,count:s,title:this.state.getFoldersGroupTitle()},containersOnly:this.containersOnly}}var r=e&&e.get("id")?Object.assign(e.serialize(),{isOwn:e.get("userId")===parseInt(this.app.user.get("id"),10),color:this.getFolderColor()}):null;return{emptyFolder:t,className:this.className,folder:r,containersOnly:this.containersOnly}},clientAfterRender:function(){var e={app:this.app,active:this.getActiveFoldersIds(),selected:this.getSelectedFolder(),ownFolders:this.ownFolders,sharedFolders:this.sharedFolders,excludeActive:this.excludeActive,selectableGroup:this.selectableGroup,onSelect:this.onSelectedChange.bind(this),isGranted:this.isGranted.bind(this),onGroupClickCallback:this.onGroupClickCallback.bind(this)},i=t.FoldersList;this.containersOnly&&(i.templatePosition="bl",i.templateOffset={top:0,left:-15}),this.setView("FoldersSelectOptionsToolTip",new o({name:"FoldersSelectOptionsToolTip",params:i,classes:{"tooltip_extra-shadow":!0},content:new c(e)})),this.showLoading()},fetchFolders:function(e){var t=this;void 0===e&&(e=!1),Promise.all([this.ownFolders.fetch({reset:!0}),this.sharedFolders.fetch({reset:!0})]).then((function(){return t.render()})).catch((function(){u.warn("Can not get folders for select."),e&&t.fetchFolders()}))},handleFoldersSync:function(e){var t=this.getFoldersByModel(e).get(e.get("id"));t&&t.set(e.serialize()),this.render()},handleFoldersRemove:function(e){var t=this.getFoldersByModel(e);t.totalItems-=1,t.remove(e),this.render()},handleFoldersAdd:function(e,t,i){i.created&&(this.ownFolders.totalItems+=1,this.ownFolders.add(e,{at:0}))},handleRemoteFolderChanged:function(e){var t=e.id,i=this.getFolder(t);i&&i.fetch()},getFoldersByModel:function(e){return this[e.get("userId")===this.app.user.get("id")?"ownFolders":"sharedFolders"]},showLoading:function(){var e=this.ownFolders.pending&&this.sharedFolders.pending;this.spinner||(this.spinner=new n(s)),this.$el.toggleClass("is-fetching",e),this.spinner[e?"spin":"stop"](this.$el.get(0))},getFolder:function(e){return this.ownFolders.get(e)||this.sharedFolders.get(e)},getFolderColor:function(){var e=this;return l((function(){return e.getSelectedFolder().get("preferences").get("folderViewColor").get("value")}),"")||"696969"},getSelectedFolder:function(){var e=this,t=this.selected?this.getFolder(this.selected.id):null;if(t)return t;var i=this.getActiveFoldersIds(),s=parseInt(this.app.user.get("id"),10),r=function(t){var r=!i.includes(t.get("id")),n=t.get("userId")===s||"edit"===t.get("permission");return e.excludeActive&&r&&e.onlyEditable&&n};return this.ownFolders.find(r)||this.sharedFolders.find(r)},onClick:function(e){(this.ownFolders.length||this.sharedFolders.length)&&this.getView("FoldersSelectOptionsToolTip").toggle(e)},getActiveFoldersIds:function(){var e=this.getActiveFolder();return e?e instanceof Array?e.map((function(e){return e.get("id")})):[e.get("id")]:[]},onSelectedChange:function(e){if(this.getView("FoldersSelectOptionsToolTip").hide(),this.isGranted("auth")){var t=parseInt(e,10);this.selected=this.getFolder(t),this.onFoldersChange(this.selected),this.render()}},onGroupClickCallback:function(e){this.isGranted("auth")?this.selectableGroup?this.state.set({folderID:e}):this.getView("FoldersSelectOptionsToolTip").onTargetPosition():this.getView("FoldersSelectOptionsToolTip").hide()},serializeForm:function(){return{folder:this.getSelectedFolder().get("id")}},getActiveFolder:function(){},onFoldersChange:function(){}})}).call(this,i(8)(e))},1927:function(e,t,i){"use strict";(function(e){var t=i(27),s=(0,i(11).getLogger)(e),r=i(1746),n={EmptySelectionFolders:i(2305),CreateFolder:i(2150),EditFolder:i(2307),DeleteFolder:i(2308),ShareFolder:i(1802),MoveFiles:i(2151),DeleteFiles:i(2152),CopyFiles:i(2069)},a=function(e){return e instanceof t.Model?[e.get("id")]:e instanceof Array?e.map((function(e){return e.get("id")})):[]},o=function(e,t){return new n[e](Object.assign({destroyOnHide:!0},t))};e.exports={createFolder:function(e,t){return new Promise((function(i){o("CreateFolder",{app:e,model:new r({},{app:e}),onCancelCallback:i,onSubmitCallback:function(r){t.createFolder(r).then((function(t){e.observer.broadcast(t.get("isPublic")?"Track:UE:Folders:CreatePublicPopup":"Track:UE:Folders:CreatePopup")})).catch((function(e){return s.error("Can't create folder. Error: "+e)})).finally(i)}}).show()}))},editFolder:function(e,t){return new Promise((function(i){o("EditFolder",{app:e,model:t,onCancelCallback:i,onSubmitCallback:function(r){t.promiseSave(r,{wait:!0,observable:!0}).then((function(){e.observer.fire("Notification",{type:"success"}),e.observer.broadcast(t.get("isPublic")?"Track:UE:Folders:EditPublicPopup":"Track:UE:Folders:EditPopup")})).catch((function(e){return s.error("Can't edit folder. Error: "+e)})).finally(i)}}).show()}))},moveFolders:function(e){var t=this;void 0===e&&(e={});var i=e,r=i.app,n=i.folders,l=i.foldersToMove,c=i.isGranted,d=void 0===c?function(){}:c,u=a(l);return new Promise((function(e){o("MoveFiles",{app:r,folders:n,getActiveFolder:function(){return l},isGranted:d,onCancelCallback:e,onSubmitCallback:function(i){t.moveFoldersWithoutModal(r,n,u,i.folder).catch((function(e){return s.error("Can't move folders. Error: "+e)})).finally(e)}}).show()}))},moveFoldersWithoutModal:function(e,t,i,s){return t.moveFolders({source:i,target:s}).then((function(){t.fetch({reset:!0}),e.observer.fire("Notification",{type:"success"}),e.observer.broadcast("Track:UE:Folders:Move")}))},copyFolders:function(e){var t=e.app,i=e.folders,r=e.foldersToCopy,n=e.isGranted,a=void 0===n?function(){}:n,l=r instanceof Array?r:[r];return new Promise((function(e){o("CopyFiles",{app:t,getActiveFolder:function(){return r},isGranted:a,onCancelCallback:e,onSubmitCallback:function(r){i.copyFolders({source:l.map((function(e){return e.get("id")})),target:r.folder}).then((function(e){i.fetch({reset:!0}),t.observer.fire("Favorites:RemoteFolderChanged",{id:e.target}),t.observer.fire("Notification",{type:"success"})})).catch((function(e){s.error("Can't copy files. Error: "+e),t.observer.fire("Notification",{type:"error"})})).finally(e)}}).show()}))},addToCart:function(e,t,i){var s=a(i);t.addToCart(s).then((function(){e.observer.fire("Notification",{type:"success"}),e.store.get("CartIndicator").fetch()}))},shareFolders:function(e,t,i,s){var r=this,n=t instanceof Array&&1===t.length?t[0]:t;s||n instanceof Array?this.callShareFolderModal(e,n,i,s):n.fetch({getQueryParams:{thumbsSize:"thumb",thumbsLimit:6}}).then((function(){r.callShareFolderModal(e,n,i,n.get("thumbs"))}))},callShareFolderModal:function(e,t,i,s){o("ShareFolder",{app:e,model:t,permissions:i,collection:s,asyncPermissionsLoad:!i}).show(),e.observer.broadcast("Track:UE:Folders:SharePopup")},removeFolders:function(e,t){var i=t instanceof Array?t:[t];return new Promise((function(t){o("DeleteFolder",{app:e,onCancelCallback:t,onSubmitCallback:function(){var r=i.map((function(e){return e.destroy()}));Promise.all(r).then((function(){e.observer.fire("Notification",{type:"success"})})).catch((function(t){e.observer.fire("Notification",{type:"error"}),s.error("Can't remove folder. Error: "+t)})).finally(t),e.observer.broadcast("Track:UE:Folders:DeletePopup")}}).show({model:1===i.length?i[0]:i})}))},callModal:function(){return o.apply(void 0,arguments)}}}).call(this,i(8)(e))},2019:function(e,t,i){"use strict";var s=i(0),r=i(15),n=function(){function e(e,t){var i=this;this.field=r(e),this.holder=null,this.options=s.extend({mode:"count",holder:"parent",min:0,max:0,prefix:"",format:"%count%"},t),this.createIndicator(),this.options.max>0&&this.field.attr("maxlength",this.options.max),this.field.on("input",(function(){return i.count()})),this.count()}var t=e.prototype;return t.createIndicator=function(){"object"==typeof this.options.holder?this.holder=this.options.holder:"parent"===this.options.holder?this.holder=this.field.parent():this.holder=r(this.options.holder),this.indicator=r("<i />",{class:"field-counter"}),this.holder.append(this.indicator)},t.count=function(){var e=this.field.val().length;"countdown"===this.options.mode&&(e=this.options.max-e);var t=this.options.format.replace("%count%",e).replace("%max%",this.options.max).replace("%prefix%",this.options.prefix);this.indicator.text(t),e>this.options.max||e<this.options.min||"countdown"===this.options.mode&&e<0?(this.field.trigger("incorrect"),this.indicator.addClass("red")):(this.field.trigger("reset"),this.indicator.removeClass("red"))},e}();e.exports=function(e,t){e.each((function(e,i){new n(i,t)}))}},2067:function(e,t,i){"use strict";var s=i(1258),r=i(2149);e.exports=s.extend({url:"Folders",model:r,experimentalTrueParse:function(e,t){var i=e.lightboxes,s=void 0===i?[]:i,n=e.count;e.stats;return void 0===t&&(t={}),this.totalItems=parseInt(n,10),t.parse=!1,t.trueparse=!0,s.map((function(e){return r.prototype.parse(e,t)}))},parse:function(e,t){return this.experimentalTrueParse(e,t)},createFolder:function(e){var t=this;void 0===e&&(e={});var i=new r(e,{app:this.app});return i.promiseSave({},{wait:!0}).then((function(){return t.add(i,{at:0,created:!0})}))},updateFolder:function(e,t,i){return this.get(e).save(t,Object.assign({wait:!0,observable:!0},i))},deleteFolder:function(e){return this.get(e).destroy()},deleteFolders:function(e){var t=this;return e.forEach((function(e){return t.deleteFolder(e)}))},addToCart:function(e){var t=this;return this.promiseSync("update",this,{url:"CartFolderFiles",getQueryParams:{folderId:e}}).then((function(){return t.trigger("sync",t)}))},moveFolders:function(e){var t=this;return this.promiseSync("update",this,{url:"MoveFolderFiles",getQueryParams:e}).then((function(){return t.trigger("sync",t)}))},copyFolders:function(e){var t=this;return this.promiseSync("update",this,{url:"CopyFolderFiles",getQueryParams:e}).then((function(){return t.trigger("sync",t),e}))},isPageSetAndCorrect:function(){return this.app.queryParams.page&&!this.pager.hasNextPage(+this.app.queryParams.page)?(this.pager.set("totalItems",this.totalItems),this.pager.getUrl({page:this.pager.get("totalPages")})):null},onPagerChange:function(){this.fetch()}})},2068:function(e,t,i){"use strict";var s=i(0),r=i(2306),n=i(754),a=i(2019);e.exports=n.extend({name:"EditFolderForm",template:r,clientAfterRender:function(){a(this.$("._counter"),{mode:"countdown",max:50})},serializeForm:function(){return{title:s.escape(this.$el.find("[name=title]").val().trim())}},serialize:function(){return this.model.serialize()}})},2069:function(e,t,i){"use strict";var s=i(92),r=i(683),n=i(691),a=i(1926);e.exports=n.extend({name:"CopyFiles",initialize:function(){var e=this;this.title=s.CopyFilesTitle,this.body=function(){return new r({className:"fav-modal",views:{"":[new r({tagName:"p",className:"modal__text modal__text_indent",template:function(){return e.tr(s.CopyFilesMessage)+":"}}),new a({app:e.app,className:"fav-modal__select fav-modal__select_rounded fav-modal__select_large",getActiveFolder:e.getActiveFolder,excludeActive:!0,onlyEditable:!0,isGranted:e.isGranted.bind(e)})]}})},this.footer=[{label:s.CancelBtn,hide:!0,callback:this.onCancelCallback.bind(this)},{label:s.CopyFilesBtn,hide:!0,color:"blue",defaultAction:!0,callback:this.onSubmit.bind(this)}]},onSubmit:function(){var e=this.findView("FoldersSelect").serializeForm();this.onSubmitCallback(e)}})},2149:function(e,t,i){"use strict";var s=i(1746);e.exports=s.extend({getQueryParams:function(){return Object.assign({},this.attributes,{thumbsSize:"thumb",thumbsLimit:4})}})},2150:function(e,t,i){"use strict";var s=i(92),r=i(691),n=i(2068);e.exports=r.extend({name:"CreateFolder",initialize:function(){var e=this;this.title=s.CreateFolderTitle,this.body=function(){return new n({model:e.model,submit:e.onSubmit.bind(e)})},this.footer=[{label:s.CancelBtn,hide:!0,callback:this.onCancelCallback.bind(this)},{label:s.CreateFolderBtn,color:"blue",defaultAction:!0,callback:this.onSubmit.bind(this)}]},onSubmit:function(){var e=this.getBodyView().serializeForm();this.onSubmitCallback(e),this.hide()}})},2151:function(e,t,i){"use strict";var s=i(92),r=i(683),n=i(691),a=i(1926);e.exports=n.extend({name:"MoveFiles",initialize:function(){var e=this;this.title=this.tr("Move Selected Files"),this.body=function(){return new r({className:"fav-modal",views:{"":[new r({tagName:"p",className:"modal__text modal__text_indent",template:function(){return e.tr("Select a folder to move the selected files to")+":"}}),new a({app:e.app,className:"fav-modal__select fav-modal__select_rounded fav-modal__select_large",getActiveFolder:e.getActiveFolder,collection:e.folders,excludeActive:!0,onlyEditable:!0,isGranted:e.isGranted.bind(e)})]}})},this.footer=[{label:s.CancelBtn,hide:!0,callback:this.onCancelCallback.bind(this)},{label:this.tr("Move Files"),hide:!0,color:"blue",defaultAction:!0,callback:this.onSubmit.bind(this)}]},onSubmit:function(){var e=this.findView("FoldersSelect").serializeForm();this.onSubmitCallback(e)}})},2152:function(e,t,i){"use strict";var s=i(92),r=i(691);e.exports=r.extend({initialize:function(){for(var e=this,t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];r.prototype.initialize.apply(this,i),this.title=s.DeleteFilesTitle,this.message=this.tr(s.DeleteFilesMessage),this.footer=[{label:s.CancelBtn,hide:!0,callback:function(){return e.onCancelCallback()}},{label:s.DeleteFilesBtn,color:"blue",hide:!0,defaultAction:!0,callback:function(){return e.onSubmitCallback()}}]}})},2298:function(e,t,i){},2299:function(e,t,i){"use strict";e.exports=function(e){var t="undefined"!=typeof _encodeHTML?_encodeHTML:function(e){var t={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},i=/&(?!#?\w+;)|<|>|"|'|\//g;return function(e){return(null==e?"":""+e).replace(i,(function(e){return t[e]||e}))}}(),i='<div class="'+t(e.className)+'"><span class="folders-select__selected-folder">';return e.folder?(i+='<i class="folders-select__selected-folder-icon">',e.folder.isOwn?i+='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 16"><path fill="#'+(e.folder.color||696969)+'" fill-rule="evenodd" d="M18 16H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h4a2 2 0 0 1 2 1l1 1h9a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2zm-4-8l-1-4-2 4H7l3 2-1 4 3-2 4 2-1-4 3-2z"/></svg>':i+='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 16"><path fill="#'+(e.folder.color||696969)+'" fill-rule="evenodd" d="M18 16H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h4a2 2 0 0 1 2 1l1 1h9a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2zm-3-5a1 1 0 0 1-1 0v-1a3 3 0 0 0 0-1 2 2 0 0 0 1-1V7a7 7 0 0 0 0-1 2 2 0 0 0-1-1 2 2 0 0 0 0-1 1 1 0 0 0-1 0 6 6 0 0 0-1 0 2 2 0 0 0-2 2 5 5 0 0 0 0 1v1a1 1 0 0 0 1 1 3 3 0 0 0 0 1v1a1 1 0 0 1-1 0l-2 2v1h9v-1l-2-2z" /></svg>',i+='</i><span class="fav-panel__selected-folder-title">'+t(e.folder.title)+"</span>",e.containersOnly||(i+='<span class="fav-panel__selected-folder-counter">'+t(e.folder.count)+"</span>")):(i+='<i class="folders-select__selected-folder-icon icon-my-folders"></i><span class="fav-panel__selected-folder-title ',e.emptyFolder.isShownCounter||(i+="fav-panel__selected-folder-title_without-counter"),i+='">'+t(e.emptyFolder.title)+"</span>",e.emptyFolder.isShownCounter&&(i+='<span class="fav-panel__selected-folder-counter">0</span>')),i+='</span><div class="folders-select__arrows-container"><i class="folders-select__arrows arrow arrow-black arrow-vertical"></i></div></div>'}},2300:function(e,t,i){"use strict";function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e}).apply(this,arguments)}i(2301);var r=i(1004),n=i(2302),a=i(1296).default,o=i(2303),l=i(683);e.exports=l.extend({name:"FoldersSelectOptions",el:!1,template:n,active:null,selected:null,folders:null,selectableGroup:!1,events:{click:"onClick"},prepareRender:function(){var e={app:this.app,name:"owner",active:this.active,selected:this.selected,folders:this.ownFolders,excludeActive:this.excludeActive,selectableGroup:this.selectableGroup,onSelect:this.onSelect.bind(this),isGranted:this.isGranted.bind(this),onGroupClickCallback:this.onGroupClickCallback.bind(this)};this.setViews({"._owner-group":new o(e),"._shared-group":new o(s({},e,{name:"shared",folders:this.sharedFolders}))})},clientAfterRender:function(){var e=this;setTimeout((function(){return e.initPerfectScrollbar()}),0)},initPerfectScrollbar:function(){var e=this.$("._list").get(0);r.initialize(e,a)},onClick:function(e){e.stopPropagation()},onSelect:function(){},onGroupClickCallback:function(){}})},2301:function(e,t,i){},2302:function(e,t,i){"use strict";e.exports=function(e){return'<div class="select-folder"><div class="select-folder__list _list"><div class="_owner-group"></div><div class="_shared-group"></div></div></div>'}},2303:function(e,t,i){"use strict";var s=i(2304),r=i(683);e.exports=r.extend({name:"FoldersSelectOptionsGroup",el:!1,template:s,active:null,selected:null,folders:null,selectableGroup:!1,events:{"click ._group":"onGroupClick","change ._folder-selection":"onFolderSelectionChange","click ._load":"handleLoadAllClick"},initialize:function(){this.listenTo(this.folders,"update",this.render)},serialize:function(){return{selected:this.selected?this.selected.get("id"):null,group:this.getGroupData()}},getGroupData:function(){var e=this,t={name:this.name,list:this.getFoldersWithColors(this.folders.serialize()),count:this.folders.getPager("totalItems"),hasNextPage:this.folders.pager.hasNextPage()};return this.excludeActive&&(t.list=t.list.filter((function(t){return!e.active.includes(t.id)}))),t},onFolderSelectionChange:function(e){this.onSelect(e.currentTarget.value)},getFoldersWithColors:function(e){return e.map((function(e){var t=e.preferences.find((function(e){return"folderViewColor"===e.name}));return t&&(e.viewColor=t.value),e}))},onGroupClick:function(e){this.selectableGroup||this.$(e.currentTarget).toggleClass("select-folder__part_closed"),this.onGroupClickCallback(e.currentTarget.dataset.group)},handleLoadAllClick:function(e){this.folders.setPager({limit:this.folders.totalItems}),this.$el.find("._load").addClass("loading")},onSelect:function(){},onGroupClickCallback:function(){}})},2304:function(e,t,i){"use strict";e.exports=function(e){var t="undefined"!=typeof _encodeHTML?_encodeHTML:function(e){var t={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},i=/&(?!#?\w+;)|<|>|"|'|\//g;return function(e){return(null==e?"":""+e).replace(i,(function(e){return t[e]||e}))}}(),i="<div>";e.group.list.length&&(i+='<div class="select-folder__part _group" data-group="'+t(e.group.name)+'">',"shared"===e.group.name?i+='<i class="select-folder__part-icon icon icon-shared-folders"></i>'+this.tr("Shared With Me"):i+='<i class="select-folder__part-icon icon icon-my-folders"></i>'+this.tr("My Folders"),i+='<span class="select-folder__part-size">'+t(e.group.count)+"</span></div>"),i+='<div class="select-folder__sub-list">';var s=e.group.list;if(s)for(var r,n=-1,a=s.length-1;n<a;)(r=s[n+=1])&&(i+='<label class="select-folder__item"><input class="select-folder__radio _folder-selection" type="radio" name="folder" value="'+t(r.id)+'"',e.selected===r.id&&(i+=' checked="checked"'),i+=" />",e.selected===r.id?(i+='<i class="select-folder__icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19 16"><path fill="',r.viewColor?i+="#"+t(r.viewColor):i+="#969696",i+='" fill-rule="evenodd" d="M17 16H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h4a2 2 0 0 1 2 1l1 1h8a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2zM14 5l-6 6-2-2-1 1 3 3 7-7z"/></svg></i>'):(i+='<i class="select-folder__icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19 16"><path fill="',r.viewColor?i+="#"+t(r.viewColor):i+="#d2d2d2",i+='" fill-rule="evenodd" d="M17 16H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h4a2 2 0 0 1 2 1l1 1h8a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2z"/></svg></i>'),i+='<span class="select-folder__text"><span class="select-folder__title">'+t(r.title)+'</span><span class="select-folder__counter">'+r.count+"</span></span>","shared"===e.group.name?("view"===r.permission&&(i+='<i class="select-folder__badge icon icon-folder-action-view"></i>'),"edit"===r.permission&&(i+='<i class="select-folder__badge icon icon-folder-action-edit"></i>')):r.isShared&&(i+='<i class="select-folder__badge icon icon-folder-action-share"></i>'),i+="</label>");return e.group.hasNextPage&&(i+='<div class="select-folder__load-more _load"><i class="icon icon-load-more"></i><span>'+this.tr("Load all")+"</span></div>"),i+="</div></div>"}},2305:function(e,t,i){"use strict";var s=i(92),r=i(691);e.exports=r.extend({name:"emptySelectionModal",title:s.ServiceModalTitle,message:function(){return this.tr(s.SelectFolders)}})},2306:function(e,t,i){"use strict";e.exports=function(e){var t="undefined"!=typeof _encodeHTML?_encodeHTML:function(e){var t={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},i=/&(?!#?\w+;)|<|>|"|'|\//g;return function(e){return(null==e?"":""+e).replace(i,(function(e){return t[e]||e}))}}(),i='<form class="modal__form"><label class="modal__form-field field-box field-box_light field-box_rounded field-box_large"><input class="input input-l _counter _field ';return e.title||(i+="empty"),i+='" type="text"name="title" maxlength="50" value="'+t(e.title)+'"/><span class="field-box__title">'+this.tr("Folder name")+"</span></label></form>"}},2307:function(e,t,i){"use strict";var s=i(92),r=i(691),n=i(2068);e.exports=r.extend({name:"EditFolder",initialize:function(){var e=this;this.title=s.EditFolderTitle,this.body=function(){return new n({model:e.model,submit:e.onSubmit.bind(e)})},this.footer=[{label:s.CancelBtn,hide:!0,callback:this.onCancelCallback.bind(this)},{label:s.SaveChangesBtn,hide:!0,color:"blue",defaultAction:!0,callback:this.onSubmit.bind(this)}]},onSubmit:function(){var e=this.getBodyView().serializeForm();this.onSubmitCallback(e),this.hide()}})},2308:function(e,t,i){"use strict";var s=i(92),r=i(691);e.exports=r.extend({name:"DeleteFolder",initialize:function(){for(var e=this,t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];r.prototype.initialize.apply(this,i),this.title=s.DeleteFolder,this.message=function(){if(e.model instanceof Array)return e.tr("Do you really want to delete %s folders?",e.model.length);var t=e.model.serialize().title;return e.tr("Do you really want to delete this folder")+' "'+t+'"?'},this.footer=[{label:s.CancelBtn,hide:!0,callback:this.onCancelCallback.bind(this)},{label:s.DeleteFolder,hide:!0,color:"blue",defaultAction:!0,callback:this.onSubmitCallback.bind(this)}]}})},2309:function(e,t,i){"use strict";var s=i(1074),r=i(1927);e.exports={isGranted:function(e,t){var i=this;if(void 0===t&&(t=!0),!["string","object"].includes(typeof e))return!1;var s="string"==typeof e?e.split(" "):e,r={auth:{rule:function(){return i.app.user.isLoggedIn()},handler:function(){return i.authHandler()}},selection:{rule:function(){return i.isAnySelected()},handler:function(){return i.selectionHandler()}},edit:{rule:function(){return i.canEditFolderOrFolders()},handler:function(){return i.callModal("NeedPermission",{app:i.app}).show()}},remove:{rule:function(){return i.hasPermissionsTo("delete")},handler:function(){return i.callModal("NeedPermission",{app:i.app}).show()}},changeFiles:{rule:function(){return i.hasPermissionsTo("changeFiles")},handler:function(){return i.callModal("NeedPermission").show()}}};return s.every((function(e){var i=r[e]&&r[e].rule();return!i&&t&&r[e].handler(),i}))},isAnySelected:function(){return this.state.isFilesMode()?this.getSelectedFiles().length>0:this.getSelectedFolders().length>0},selectionHandler:function(){return this.state.isFilesMode()?this.callModal("EmptySelectionFiles").show():r.callModal("EmptySelectionFolders",{app:this.app}).show()},authHandler:function(e){var t=this;void 0===e&&(e="Click");var i=this.app.store.get("FileForFavorite"),r=null;i&&(r=new s({id:i.get("id"),imageUrl:i.makeThumb("wide"),width:i.get("width"),height:i.get("height"),type:i.get("type"),alt:i.get("title")},{app:this.app})),this.app.store.get("ModalsManager").show("SignupModal",{app:this.app,title:this.tr("Add to Favorites?"),previewFile:r}).then((function(){t.app.observer.broadcast("Track:UE:SignUp:ModalShow",{label:t.name+"/"+e}),t.app.store.unlink("FileForFavorite")})).catch((function(){}))},canEditFolderOrFolders:function(){if(this.state.isFilesMode()){var e=this.getActiveFolder();return e&&"edit"===e.get("permission")}var t=this.getSelectedFolders();return t.length&&t.every((function(e){return"edit"===e.get("permission")}))},hasPermissionsTo:function(e){if(this.state.isFilesMode()){var t=this.getActiveFolder();return t&&t.hasAction(e)}var i=this.getSelectedFolders();return i.length&&i.every((function(t){return t.hasAction(e)}))}}},2315:function(e,t,i){"use strict";var s=i(92).ServiceModalTitle,r=i(691);e.exports=r.extend({name:"needPermissionModal",title:s,message:function(){return this.activeFolder?this.tr('"%s" folder is available to you in a "Read-only" format. Please contact the owner of the folder for permission to edit.',this.activeFolder.get("title")):this.tr("Sorry, you have no editing permissions.")}})},2316:function(e,t,i){"use strict";var s=i(92),r=i(691);e.exports=r.extend({name:"emptySelectionModal",title:s.ServiceModalTitle,message:function(){return this.tr(s.EmptySelectionMessageFiles)}})},2317:function(e,t,i){"use strict";var s=i(6);e.exports=s.extend({defaults:{userId:null,open:!1,editor:!1,folderID:null,thumbs:"normal",liftLevel:2},isFilesMode:function(){return!["owner","shared"].includes(this.get("folderID"))},isEmptyFoldersMode:function(){return!this.get("folderID")},wasFoldersMode:function(){return["owner","shared"].includes(this.previous("folderID"))},getFoldersGroupTitle:function(e){return void 0===e&&(e=this.get("folderID")),{owner:this.app.tr("My Folders"),shared:this.app.tr("Shared With Me")}[e]},getFoldersGroupPermissions:function(e){void 0===e&&(e=this.get("folderID"));return{owner:["owner"],shared:["edit","view"]}[e]}})},3445:function(e,t,i){"use strict";var s=function(e){return e&&e.__esModule?e:{default:e}}(i(686));function r(e,t,i,s,r,n,a){try{var o=e[n](a),l=o.value}catch(e){return void i(e)}o.done?t(l):Promise.resolve(l).then(s,r)}function n(e){return function(){var t=this,i=arguments;return new Promise((function(s,n){var a=e.apply(t,i);function o(e){r(a,s,n,o,l,"next",e)}function l(e){r(a,s,n,o,l,"throw",e)}o(void 0)}))}}function a(){return(a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e}).apply(this,arguments)}i(3446),i(1339);var o=i(0),l=i(683),c=i(3447),d=i(2149),u=i(2067),h=i(3451),p=i(1506),f=i(3452),g=i(35),m=i(2317),v=i(2316),b=i(3454),_=i(2315),y=i(2150),F=i(2069),w=i(2151),k=i(2152),C=i(1927),x=i(2309),S=i(95),P=i(2647),T="nonAuthFavFileAdding",I={page:1,limit:60},A={EmptySelectionFiles:v,CopyFiles:F,MoveFiles:w,DeleteFiles:k,SelectFolder:b,CreateFolder:y,NeedPermission:_},M={chunkName:"chunk_fav_panel_opened",promiseCb:function(e,t){return Promise.all([i.e(4),i.e(147),i.e(128)]).then(function(t){var s=i(3594);e(s)}.bind(null,i)).catch(t)}};e.exports=l.extend(a({},x,{name:"FavoritesPanel",tagName:"div",className:"fav-panel-box",webSocketClient:null,initialStateOverrides:{},filesQueue:[],FavoritesPanelOpened:null,initialize:function(){var e=this;this.state=new m(this.getInitialState(),{app:this.app}),this.activeFolder=new d({},{app:this.app}),this.activeFolder.getQueryParams=function(){return a({},e.activeFolder.serialize(),{id:e.state.get("folderID")})},this.folders=new u([],{app:this.app,endless:!0,pager:I,filters:{permission:this.state.getFoldersGroupPermissions(),thumbsSize:"thumb",thumbsLimit:1}}),this.permissions=new p([],{app:this.app}),this.cache=new h([],{app:this.app}),this.collection=new f([],{app:this.app,pager:I,filters:{id:null},endless:!0}),this.selectedByContextMenu=new g([],{app:this.app}),this.app.store.link("FolderCache",this.cache),this.app.store.link("FolderState",this.state),this.listenTo(this.state,"change:folderID",this.onStateFolderIdChange),this.listenTo(this.collection,"update",this.actualizeCache),this.listenTo(this.cache,"reset update",this.folderCacheUpdateCallback),this.listenTo(this.folders,{update:this.handleFoldersUpdate}),this.listenTo(this.app.observer,{"Favorites:OpenPanel":this.handleDrag,"Favorites:ToggleFile":this.toggleFile,"Favorites:TogglePanel":this.togglePanel}),this.shouldFetchComponentsForOpenState()&&this.fetchComponentsForOpenState().then((function(){return e.render()})),this.isGranted("auth",!1)&&(this.state.get("folderID")||this.tryPlaceFirstFolderAsActive(),this.onStateFolderIdChange())},prepareRender:function(){var e=this;return!this.shouldFetchComponentsForOpenState()&&(this.setViews({"":this.state.get("open")?new this.FavoritesPanelOpened({app:this.app,state:this.state,cache:this.cache,collection:this.collection,folders:this.folders,permissions:this.permissions,activeFolder:this.activeFolder,selectedByContextMenu:this.selectedByContextMenu,isGranted:this.isGranted.bind(this),togglePanel:this.togglePanel.bind(this),callModal:this.callModal.bind(this),getActiveFolder:this.getActiveFolder.bind(this),isActiveFolderExist:this.isActiveFolderExist.bind(this),addFile:this.addFile.bind(this),deleteFile:this.deleteFile.bind(this),getSelectedFiles:this.getSelectedFiles.bind(this),getSelectedFolders:this.getSelectedFolders.bind(this),autoCreateFolder:this.autoCreateFolder.bind(this),updatePanelState:this.updatePanelState.bind(this),getWebSocketClient:function(){return e.webSocketClient},setWebSocketClient:function(t){e.webSocketClient=t},fetchFolders:this.fetchFolders.bind(this),fetchPermissions:this.fetchPermissions.bind(this),fetchCache:this.fetchCache.bind(this),fetchFolderDependencies:this.fetchFolderDependencies.bind(this)}):new c({app:this.app,state:this.state,collection:this.collection,shouldCallSignUpWhenOpen:this.shouldCallSignUpWhenOpen,openPanel:this.openPanel.bind(this),authHandler:this.authHandler.bind(this),getActiveFolder:this.getActiveFolder.bind(this)})}),!0)},getInitialState:function(){var e=this.app.userSettings.get("FavoritesPanel"),t=this.app.user.get("id");return e&&e.userId===t?a({},e,this.initialStateOverrides):a({userId:t},this.initialStateOverrides)},resetPanelToEmptyState:function(){this.updatePanelState({folderID:null}),this.collection.reset(),this.cache.reset(),this.checkFileToAddQueue()},handleFoldersUpdate:function(e,t){var i=t.created;t.reset;e.isEmpty()?this.resetPanelToEmptyState():i&&this.updatePanelState({folderID:e.first().get("id")})},actualizeCache:function(e,t){var i=t.changes,s=t.at;if(i){var r=i.added.map((function(e){return{id:e.get("id")}})),n=i.removed.map((function(e){return e.get("id")}));this.cache.add(r,{at:s,silent:!0}),this.cache.remove(n,{silent:!0}),this.cache.trigger("update",this.cache,{changes:i,at:s,refetch:!0})}},getSelectedFiles:function(){return this.cache.where({selected:!0})},getSelectedFolders:function(){return this.folders.where({selected:!0}).concat(this.selectedByContextMenu.models)},fetchFolders:function(e,t){var i=this.state.getFoldersGroupPermissions();if(!i){var s=this.getActiveFolder().get("userId")!==this.app.user.get("id")?"shared":"owner";i=this.state.getFoldersGroupPermissions(s)}this.folders.setFilters({permission:i}),this.folders.fetchPage(e,t)},innerAddFile:function(e,t){var i=this;void 0===t&&(t=0),this.isActiveFolderExist()?this.collection.addFile(e,this.getActiveFolder().get("id"),t):this.autoCreateFolder().then((function(){return i.collection.addFile(e,i.state.get("folderID"),t)}))},innerDeleteFile:function(e){var t=this,i=[e],s=this.cache.indexOf(this.cache.get(e));this.collection.delete({lightbox:this.state.get("folderID"),items:[e],positions:[s]}).then((function(){t.cache.remove(i)}))},toggleFile:o.throttle((function(e){if(!this.folders.length||this.state.isFilesMode())!this.isActiveFolderExist()||this.isGranted("changeFiles",!1)?this.toggleFileById(0|e.id):this.callModal("NeedPermission",{activeFolder:this.activeFolder}).show();else{var t=this.folders.last();t.hasAction("changeFiles")?(this.filesQueue.push(0|e.id),this.updatePanelState({folderID:t.get("id")})):this.callModal("SelectFolder",{onAfterHideCallback:function(){this.openPanel()}})}}),400),toggleFileById:function(e){this.cache.get(e)?this.deleteFile(e):this.addFile(e)},deleteFile:function(){this.isGranted("auth changeFiles")&&this.innerDeleteFile.apply(this,arguments)},addFile:function(e,t){e&&(this.isGranted("auth",!1)?(this.app.store.unlink("FileForFavorite"),this.innerAddFile(e,t)):(this.authHandler("addToFavorites"),this.updateCookieState({key:T,value:e})))},callModal:function(e,t){return this.insertView(e,new A[e](Object.assign({app:this.app,destroyOnHide:!0},t)))},updatePanelState:function(e){this.state.set(e),this.app.userSettings.set({FavoritesPanel:this.state.toJSON()}),this.updateCookieState()},updateCookieState:function(e){var t={expires:"1Y"};if(e)S.set(e.key,e.value,t);else{var i=o.omit(this.state.attributes,["open","folderID","liftLevel"]);i.visible=this.state.get("open"),i.lightbox=this.state.get("folderID"),i.thumbs="big"===i.thumbs?"medium":"small",S.set("10_lbpSettings",JSON.stringify(i),t),S.set("10_currentLevel",this.state.get("liftLevel"),t)}},getActiveFolder:function(){return this.activeFolder},isActiveFolderExist:function(){return this.activeFolder.get("id")},autoCreateFolder:function(){return C.createFolder(this.app,this.folders)},checkFileToAddQueue:function(){var e=S.get(T);e&&"null"!==e&&(this.updateCookieState({key:T,value:null}),this.openPanel(),this.innerAddFile(+e))},handleDrag:function(){this.state.get("open")||(this.togglePanel(),this.app.observer.broadcast("Track:UE:FavoritesPanel:Open",{action:"drag"}))},openPanel:function(){this.state.get("open")||this.togglePanel()},togglePanel:function(){var e=this;return n(s.default.mark((function t(){return s.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.updatePanelState({open:!e.state.get("open")}),!e.shouldFetchComponentsForOpenState()){t.next=4;break}return t.next=4,e.fetchComponentsForOpenState();case 4:e.render();case 5:case"end":return t.stop()}}),t)})))()},folderCacheUpdateCallback:function(e,t){this.isActiveFolderExist()&&(this.getActiveFolder().set({count:e.length},{observable:!0}),this.app.observer.fire("Favorites:PanelCacheUpdate",{folderId:this.state.get("folderID"),options:t}))},onStateFolderIdChange:function(){var e=this;this.state.isFilesMode()?(this.activeFolder.fetch().then((function(){e.updatePanelComponents(),e.fetchFolderDependencies(e.state.wasFoldersMode()),e.processFilesQueue()})).fail((function(){return e.resetPanelToEmptyState()})),this.folders.reset()):(this.activeFolder.set(this.activeFolder.defaults),this.cache.reset(),this.collection.reset(),this.fetchFolders(1,{reset:!0}),this.updatePanelComponents())},fetchFolderDependencies:function(e){if(this.isActiveFolderExist()){var t=this.state.get("folderID")!==this.collection.getFilters("id");(e||t)&&(this.fetchPermissions(),this.fetchCache(),this.fetchFiles())}},processFilesQueue:function(){var e=this;this.isActiveFolderExist()&&0!==this.filesQueue.length&&(this.filesQueue.forEach((function(t){e.toggleFileById(t)})),this.filesQueue=[])},fetchPermissions:function(){this.permissions.getQueryParams={folderId:this.state.get("folderID")},this.permissions.fetch({reset:!0})},fetchCache:function(){var e=this.getActiveFolder();this.cache.getQueryParams={id:e.get("id")},this.cache.fetch({reset:!0})},fetchFiles:function(){this.$("._scroll").scrollTop(0),this.collection.setFilters({id:this.state.get("folderID")}),this.collection.fetchPage(1,{reset:!0})},tryPlaceFirstFolderAsActive:function(){var e=this;this.folders.fetch().then((function(){var t=e.folders.first();e.updatePanelState({folderID:t?t.get("id"):null})})).fail((function(){return e.resetPanelToEmptyState()}))},shouldFetchComponentsForOpenState:function(){return this.state.get("open")&&null===this.FavoritesPanelOpened},fetchComponentsForOpenState:function(){var e=this;return n(s.default.mark((function t(){return s.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,P.factory({app:e.app,config:M});case 2:e.FavoritesPanelOpened=t.sent;case 3:case"end":return t.stop()}}),t)})))()},updatePanelComponents:function(){var e=this.findView("FavoritesPanelContent");e&&e.render()}}))},3446:function(e,t,i){},3447:function(e,t,i){"use strict";var s=i(3448),r=i(683),n=i(3449);e.exports=r.extend({name:"FavoritesPanelClosed",template:s,events:{"click ._pull":"handlePullerClick"},prepareRender:function(){this.setViews({"._msg-box":new n({app:this.app,state:this.state,collection:this.collection,openPanelCallback:this.openPanel.bind(this),getActiveFolder:this.getActiveFolder.bind(this)})})},handlePullerClick:function(e){this.shouldCallSignUpWhenOpen?this.authHandler():this.openPanel(),this.app.observer.broadcast("Track:UE:FavoritesPanel:Open",{action:"click"})},openPanel:function(){},authHandler:function(){},getActiveFolder:function(){}})},3448:function(e,t,i){"use strict";e.exports=function(e){return'<div class="fav-panel-closed"> <div class="fav-panel-msg-box _msg-box"></div> <div class="fav-panel fav-panel_closed _pull"> <div class="fav-panel__row"> <div class="fav-panel__cell"> <div class="fav-panel__shadow"></div> </div> <div class="fav-panel__cell fav-panel__cell_middle"> <div class="fav-panel__tab-wrapper"> <div class="fav-panel__tab"> <span class="fav-panel__tab-title"> <i class="fav-panel__tab-icon icon icon-favorites"></i> '+this.tr("Favorites")+' </span> <div class="fav-panel__tab-shadow"></div> </div> </div> </div> <div class="fav-panel__cell"> <div class="fav-panel__shadow"></div> </div> </div> <div class="fav-panel__row"> <div class="fav-panel__cell"> <div class="fav-panel__bg"></div> </div> <div class="fav-panel__cell fav-panel__cell_middle"> <div class="fav-panel__bg"></div> </div> <div class="fav-panel__cell"> <div class="fav-panel__bg"></div> </div> </div> </div></div>'}},3449:function(e,t,i){"use strict";var s=i(3450),r=i(683),n=i(6);e.exports=r.extend({name:"FavoritesMessage",el:!1,template:s,count:1,timer:null,events:{"click ._open":"onOpenClick","click ._close-msg":"onCloseMsgClick"},initialize:function(){this.messageModel=new n({showed:!1,thumb:null,count:1}),this.listenTo(this.app.observer,"Favorites:fileAdded",this.fileAdded),this.listenTo(this.messageModel,"change:thumb",this.render)},serialize:function(){return{showed:this.messageModel.get("showed"),count:Math.min(this.messageModel.get("count"),3),prevCount:Math.min(this.messageModel.get("count")-1,3),folderThumb:this.messageModel.get("thumb"),folderPreviousThumb:this.messageModel.previous("thumb"),folderName:this.getFolderName()}},clientAfterRender:function(){var e=this;this.messageModel.get("showed")&&setTimeout((function(){return e.show()}),100)},getFolderName:function(){var e=this.getActiveFolder();return e?e.get("title"):""},fileAdded:function(e){if(!this.state.get("open")&&this.collection.get(e.id)){var t=this.messageModel.get("count");this.messageModel.get("showed")?t+=1:t=1,this.messageModel.set({showed:!0,thumb:this.collection.get(e.id).makeThumb("normal"),count:t})}},show:function(){var e=this;clearTimeout(this.timer),this.$el.addClass("fav-msg_visible"),this.$("._img").removeClass("fav-msg__img_hidden"),setTimeout((function(){return e.$("._img-box").addClass("fav-msg__img-box_count"+e.messageModel.get("count"))}),200),this.timer=setTimeout((function(){return e.hide()}),3e3)},hide:function(){var e=this;this.$el.removeClass("fav-msg_visible"),setTimeout((function(){return e.messageModel.set({showed:!1,count:1,thumb:null})}),200)},onOpenClick:function(){this.openPanelCallback(),this.hide()},onCloseMsgClick:function(e){e.stopPropagation(),clearTimeout(this.timer),this.hide()},openPanelCallback:function(){}})},3450:function(e,t,i){"use strict";e.exports=function(e){var t="undefined"!=typeof _encodeHTML?_encodeHTML:function(e){var t={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},i=/&(?!#?\w+;)|<|>|"|'|\//g;return function(e){return(null==e?"":""+e).replace(i,(function(e){return t[e]||e}))}}(),i='<div class="fav-msg';return e.showed&&e.count>1&&(i+=" fav-msg_visible"),i+='"><div class="fav-msg__wrap _open"><div class="fav-msg__img-box fav-msg__img-box_count'+e.prevCount+' _img-box"><div class="fav-msg__img',e.folderPreviousThumb&&(i+=" fav-msg__img_hidden"),i+=' _img"',e.folderThumb&&(i+=' style="background-image: url('+t(e.folderThumb)+');"'),i+="></div>",e.folderPreviousThumb&&(i+='<div class="fav-msg__img fav-msg__img_prev" style="background-image: url('+t(e.folderPreviousThumb)+');"></div><div class="fav-msg__img fav-msg__img_back"></div>'),i+='</div><span class="fav-msg__text">'+this.tr("Added to “<b>%s</b>”",e.folderName)+'</span><div class="fav-msg__close _close-msg"><i class="fav-msg__icon icon icon-close-small-white"></i></div><i class="fav-msg__pointer"></i></div></div>'}},3451:function(e,t,i){"use strict";var s=i(6),r=i(35);e.exports=r.extend({url:"FolderCache",model:s.extend({defaults:{id:null,selected:!1},parse:function(e){return{id:parseInt(e,10)}}}),reorder:function(e,t){var i=this;return this.sync("update",this,{getQueryParams:Object.assign({},this.getQueryParams,{fileId:e,index:t}),success:function(){return i.trigger("sync",i)}}).promise()},getSelected:function(){return this.where({selected:!0})},getSelectedIds:function(){return this.getSelected().map((function(e){return e.id}))}})},3452:function(e,t,i){"use strict";(function(e){var t=i(0),s=i(1258),r=i(3453),n=(0,i(11).getLogger)(e);e.exports=s.extend({url:"FavoriteFiles",model:r,parse:function(e){if(e instanceof Array)return e;var t=e.count,i=e.items,s=void 0===i?[]:i;return this.totalItems=Math.max(parseInt(t,10),0),s},addFile:function(e,i,s){var a=this,o=new r({id:e},{app:this.app});return this.listenToOnce(o,"sync",(function(i,r){r.errors?n.error("FavoriteFiles: "+t.pluck(r.errors,"error_message").join(". ")):(a.add(i,{at:s}),a.app.observer.fire("Favorites:fileAdded",{id:e}))})),o.save({},{wait:!0,getQueryParams:{id:e,folder:i,at:s}}).promise()},copy:function(e){var t=this;return this.sync("update",this,{url:"FavoriteFilesCopy",getQueryParams:e,success:function(){return t.trigger("sync",t,{})}})},move:function(e){var t=this;return this.sync("update",this,{url:"FavoriteFilesMove",getQueryParams:e,success:function(){t.trigger("sync",t,{}),t.remove(e.items)}})},delete:function(e){var t=this;return this.sync("update",this,{url:"FavoriteFilesRemove",getQueryParams:e,success:function(){t.trigger("sync",t,{}),t.remove(e.items),t.app.observer.fire("Favorites:filesRemoved",{ids:e.items})}})},onPagerChange:function(){this.fetch()}})}).call(this,i(8)(e))},3453:function(e,t,i){"use strict";var s=i(0),r=i(983);e.exports=r.extend({url:"FavoriteFile",getQueryParams:s.noop,parse:function(e,t){if(e.errors)return this.trigger("invalid",this,e.errors),{};var i=e.items?s.first(e.items):e;return r.prototype.parse.call(this,i,t)}})},3454:function(e,t,i){"use strict";var s=i(691);e.exports=s.extend({name:"SelectFolderModal",initialize:function(){var e=this;s.prototype.initialize.apply(this),this.title=this.tr("Select a Folder"),this.message=function(){return e.tr("Please select a folder in your Favorites to add the selected file to.")},this.footer=[{label:this.tr("Ok"),color:"blue",hide:!0,defaultAction:!0}]}})},688:function(e,t,i){"use strict";var s=i(979).spinner,r=i(0),n=i(980),a=i(14);e.exports={fieldCorrect:function(e,t){this.fieldReset(e,t),e.addClass("field-box_correct").removeClass("field-box_label-text")},fieldIncorrect:function(e,t){if(void 0===t&&(t={}),this.fieldReset(e,t),t.msgOnly||(e.addClass("field-box_incorrect").removeClass("field-box_label-text"),e.find(".field-box__right-elem").addClass("hidden")),"string"==typeof t.errorMessage){var i='<span class="field-box__error" data-id="'+this.getContextId(e)+'">'+this.tr(t.errorMessage)+"</span>";this.getErrorHolder(e,t).append(i)}this.fieldsGroupIncorrect(e)},fieldProgress:function(e,t){this.fieldReset(e,t),this.spinner||(this.spinner=new n(r.extend({},r.clone(s),{className:"field-box_spinner"}))),this.spinner.spin(e.get(0)),t&&t.keepEnabled||e.find("input, select, textarea").attr("disabled","disabled")},fieldReset:function(e,t){e.find("field-box_progress:disabled").removeAttr("disabled"),e.removeClass("field-box_correct field-box_incorrect field-box_progress"),e.find(".field-box__right-elem").removeClass("hidden"),e.attr("data-label-text")&&e.addClass("field-box_label-text"),this.spinner&&this.spinner.stop(e.get(0)),this.getErrorHolder(e,t).find('span.field-box__error[data-id="'+this.getContextId(e)+'"]').remove(),this.fieldsGroupReset(e)},onCapitalizeEvent:function(e){this.capitalize(e)},capitalize:function(e){var t=e.currentTarget.value;if(t.length<=1||"input"===e.type&&"paste"===this.prevCapitalizeEvt){var i=t.charAt(0);i!==i.toUpperCase()&&(e.currentTarget.value=a.capitalize(t))}this.prevCapitalizeEvt=e.type},getContextId:function(e){return e.attr("data-id")||e.attr("data-id",r.uniqueId("autoId_")).attr("data-id")},getErrorHolder:function(e,t){return t&&void 0!==t.errorHolder?t.errorHolder:e},handleUpdateField:function(e){void 0!==e.currentTarget.dataset.capitalize&&this.capitalize(e),this.$(e.currentTarget).toggleClass("empty",0===e.currentTarget.value.length)},getInputAdditional:function(e){return Object.keys(e).reduce((function(t,i){return t[i]=0!==parseInt(e[i],10)&&e[i]&&0!==e[i].length?"":"empty",t}),{})},getFieldsGroup:function(e){var t=e.closest("._fields-group-part"),i=e.closest("._fields-group");return i&&t?i.add(t):i||t},handleUpdateFieldFocus:function(e){var t=this.getFieldsGroup(this.$(e.currentTarget));t&&t.toggleClass("focus","focusin"===e.type)},fieldsGroupIncorrect:function(e){if(0!==e.length){var t=this.getFieldsGroup(e);t&&t.addClass("invalid")}},fieldsGroupReset:function(e){if(0!==e.length){var t=this.getFieldsGroup(e);t&&0===t.find(".field-box_correct").length&&t.removeClass("invalid")}}}},754:function(e,t,i){"use strict";var s=i(0),r=i(683),n=i(688),a=r.extend({name:"Form",el:!1,model:null,events:{submit:"onSubmit","input ._field":"onRegularFieldInput","focusin ._field":"onRegularFieldFocusIn","focusout ._field":"onRegularFieldFocusOut"},initialize:function(){if(!this.model)throw new Error(this.name+": form model is required!");this.model.enableViewValidation(this),this.setModelListeners()},setModelListeners:function(){this.listenTo(this.model,{invalid:this.handleModelInvalid,error:this.handleModelError,request:this.handleModelRequest,sync:this.handleModelResponse})},remove:function(){this.model.disableViewValidation(this);for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];r.prototype.remove.apply(this,t)},onSubmit:function(e){e&&e.preventDefault(),this.prepareSubmit(),this.validate()?this.submit():this.onPreSubmitFail()},submit:function(){this.model.save()},validate:function(){return this.model.isValid(!0)},handleModelInvalid:function(e,t){var i=this;s.size(t)&&Object.entries(t).forEach((function(e){var t=e[0],s=e[1],r=Array.isArray(s)?s[0]:s;i.fieldIncorrect(i.$("[name="+t+"]").parent(),{errorMessage:"string"==typeof r?i.tr(r):r})}))},resetErrors:function(){var e=this;s.each(this.$(".field-box_incorrect input, .field-box_incorrect select"),(function(t){return e.fieldReset(e.$(t).parent())}))},onRegularFieldInput:function(e){this.handleUpdateField(e),this.model.set(e.currentTarget.name,e.currentTarget.value)},onRegularFieldFocusIn:function(e){this.fieldReset(this.$(e.currentTarget).parent())},serialize:function(){},prepareSubmit:function(){},onPreSubmitFail:function(){},handleModelRequest:function(){},handleModelResponse:function(){},handleModelError:function(){},onRegularFieldFocusOut:function(){}});Object.assign(a.prototype,n),e.exports=a},796:function(e,t,i){"use strict";var s=i(19);e.exports={defaultType:"image",config:{wideSize:200,tinyWideSize:150,mobileWideSize:110,normalSize:110,image:{normal:110,normalSquare:111,big:170,bigWide:"170w",wideSmall:380,wide:450,huge:450,modal:550,xwide:600,broad:660,large:950,max:950},vector:{normal:110,normalSquare:111,big:170,bigWide:"170w",wideSmall:380,wide:450,huge:450,modal:550,xwide:600,broad:660,large:950,max:950},video:{normal:110,normalSquare:111,big:450,bigWide:450,broad:450,wideSmall:380,wide:450,huge:450,large:450,xwide:600}},configHuge:{video:{normal:110,normalSquare:111,big:380,bigWide:380,wideSmall:380,wide:600,xwide:600,huge:600,large:600},image:{normal:110,normalSquare:111,big:170,bigWide:"170w",wideSmall:380,wide:450,huge:450,modal:550,xwide:600,broad:660,large:950,max:1600},vector:{normal:110,normalSquare:111,big:170,bigWide:"170w",wideSmall:380,wide:450,huge:450,modal:550,xwide:600,broad:660,large:950,max:1600}},videoClipConfig:{regular:{},huge:{wide:"huge"}},getSizesConfig:function(e,t,i){return e.hasHugeVideoThumb||e.hasHugeImageThumb||e.hasHugeVectorThumb?(this.configHuge[t]||{})[i]:(this.config[t]||{})[i]},getVideoClipConfig:function(e){return e.hasHugeVideoThumb?this.videoClipConfig.huge:this.videoClipConfig.regular},getThumbUrl:function(e){if("crelloTemplate"===e.file.type&&e.file.crelloTemplateThumb)return e.file.crelloTemplateThumb;e.ext=e.ext||"jpg";var t=e.file.id.toString(),i=t.substring(0,t.length-4),r=e.file.type||this.defaultType,n=(e.genFilename?e.genFilename(e.file):e.file.filename)||"thumb",a=this.getSizesConfig(e.file,r,e.size),o="";return r&&a&&(o=s.urlFormat({protocol:e.protocol,host:e.file.thumbSource,pathname:e.file.sellerId+"/"+i+"/"+r[0]+"/"+a+"/depositphotos_"+e.file.id+"-"+n+"."+e.ext})),o},getThumbSizes:function(e,t){var i=this;if("number"==typeof t)return this.calculateSize(e,t);if("string"==typeof t)return this.getSize(e,t);var s={};return t.forEach((function(t){s[t]=i.getSize(e,t)})),s},getSize:function(e,t){var i=e.type||this.defaultType,s=this.getSizesConfig(e,i,t),r=this.calculateSize(e,s);if("wide"===t){var n=r.w,a={w:Math.round(r.w*this.config.wideSize/r.h),h:this.config.wideSize};a.w>n&&(a.w=n,a.h=Math.round(+e.height*a.w/+e.width)),r=a}else if("normalSquare"===t)r.h=s;else if("max"===t&&(e.hasHugeImageThumb||e.hasHugeVectorThumb)){r.h+=100}return r},calculateSize:function(e,t,i){var s=+e.width,r=+e.height;return"normalSquare"===i?{w:t,h:t}:{w:s>r?t:parseInt(s/Math.max(1,r)*t,10),h:s>r?parseInt(r/Math.max(1,s)*t,10):t}},hasLabel:function(e,t){return 1600===this.getSizesConfig(e,e.type,t)},getVideoClipThumbSize:function(e,t){var i=this.getVideoClipConfig(e);return i&&i[t]||t}}},929:function(e,t,i){"use strict";var s=i(0),r=i(683),n=i(35),a=i(19),o="none";e.exports=r.extend({name:"Tabs",el:!1,schema:[],subSchema:[],preventDefaultAction:!1,urlLessTabs:!1,menuUnderline:!1,classNames:"",active:"",subActive:"",serializeData:{},events:{"click ._tab":"onTabClick","mouseenter ._tab":"onTabMouseEnter","mouseleave ._tab":"onTabMouseLeave","touchend ._scroll":"onScrollTouchEnd","click ._nav-left":"onNavLeftClick","click ._nav-right":"onNavRightClick"},globals:{"resize window":"onWindowResize"},initialize:function(){this.schema=new n(s.result(this,"schema")),this.defineActiveTab(),this.subSchema=new n(s.result(this,"subSchema")),this.prepareSubTabs(),this.listenTo(this.schema,"change update",this.render)},serialize:function(){return Object.assign({},{classNames:this.classNames,urlLessTabs:this.urlLessTabs,scheme:this.getEnabled().map((function(e){return e.serialize()})),subScheme:this.subSchema.serialize(),isRendered:this.isRendered},this.serializeData)},clientAfterRender:function(){this.menuUnderline&&this.setDefaultMenuUnderline(),this.isScrollPositionSet&&(this.setScrollPosition(),this.$("._scroll").removeClass("invisible")),this.updateNavigation(),this.isRendered=!0},onWindowResize:s.throttle((function(){this.menuUnderline&&this.setDefaultMenuUnderline(),this.isScrollPositionSet&&this.setScrollPosition(),this.updateNavigation()}),10),onTabClick:function(e){var t,i=e.currentTarget.dataset.key,s=this.schema.findWhere({key:i});s&&s.get("onClick")?s.get("onClick").call(null,e):((this.preventDefaultAction||s&&s.get("toggler")||s&&s.get("active")||s&&!0===s.get("isDefault")&&this.schema.findWhere({toggler:!0,active:!0}))&&e.preventDefault(),s&&s.get("toggler")&&s.get("active")&&(i=this.schema.findWhere({isDefault:!0}).get("key"),t=s.get("key")),s&&"_blank"!==s.get("target")&&this.setActiveTab(i,t))},onTabMouseEnter:function(e){if(this.menuUnderline){var t=this.$(e.currentTarget),i=t.offset().left-this.$el.offset().left;this.menuUnderlinePosition(i,t.outerWidth())}},onTabMouseLeave:function(){if(this.schema.where({active:!0}).length>0){var e=this.schema.findWhere({pseudoActive:!0});e&&e.set({pseudoActive:!1})}this.menuUnderline&&this.setDefaultMenuUnderline()},onScrollTouchEnd:function(){this.updateNavigation()},onNavLeftClick:function(){var e=this,t=this.$("._scroll").scrollLeft();this.$("._scroll").animate({scrollLeft:Math.max(t-100,0)},300,(function(){return e.updateNavigation()}))},onNavRightClick:function(){var e=this,t=this.$("._scroll").scrollLeft();this.$("._scroll").animate({scrollLeft:t+100},300,(function(){return e.updateNavigation()}))},updateNavigation:function(){var e=this.$("._scroll");if(0!==e.length){var t=this.$("._tab:last"),i=t.offset().left+t.width()-16;this.$("._nav-left").toggleClass("active",e.scrollLeft()>16),this.$("._nav-right").toggleClass("active",i>e.width())}},setDefaultMenuUnderline:function(){var e=this.$("._tab-active"),t=e.offset().left-this.$el.offset().left;this.menuUnderlinePosition(t,e.outerWidth())},menuUnderlinePosition:function(e,t){this.$("._menu-underline").css({left:e,width:t}).removeClass("hidden")},setScrollPosition:function(){var e=this.$("._active");if(0!==e.length){var t=e.offset().left;t+e.outerWidth()>window.innerWidth&&this.$("._scroll").scrollLeft(t)}},defineActiveTab:function(){var e=this;if(this.schema.each((function(t){var i=null!=t.get("active")?t.get("active"):e.defineTabActivityByProperty(t);e.active===o&&(i=!1),t.set({url:e.app.makeUrl(t.get("urlKey")||t.get("key")||""),active:null!=i?i:e.defineTabByUrl(t),enabled:s.isUndefined(t.get("enabled"))||!0===t.get("enabled")||s.isFunction(t.get("enabled"))&&t.get("enabled")(e.app.user)})})),this.shouldForceSetActive()){var t=this.schema.findWhere({isDefault:!0})||this.schema.first();t&&this.setActiveTab(t.get("key"),void 0,{silent:!0})}},shouldForceSetActive:function(){return!(this.active===o||this.getActiveTab()&&this.getActiveTab().get("enabled"))},prepareSubTabs:function(){var e=this;this.subSchema.each((function(t){return t.set({url:e.app.makeUrl(t.get("urlKey")||t.get("key")||""),active:t.get("key")===e.subActive,enabled:s.isUndefined(t.get("enabled"))||!0===t.get("enabled")||s.isFunction(t.get("enabled"))&&t.get("enabled")(e.app.user)})}))},defineTabActivityByProperty:function(e){return this.active&&this.active.length?e.get("key")===this.active:null},defineTabByUrl:function(e){var t=this.app.makeUrl(e.get("key"));return!!t&&(this.app.parsedUrl.pathname===t||!e.get("isDefault")&&a.isBelongTo(t+"/",this.app.parsedUrl.pathname+"/"))},reset:function(e){this.setActiveTab(e||this.schema.first().get("key"))},setActiveTab:function(e,t,i){this.schema.findWhere({key:e}).get("active")||(this.getActiveTab()&&this.getActiveTab().set({active:!1}),this.schema.findWhere({key:e}).set({active:!0}),t&&this.schema.findWhere({key:t}).set({pseudoActive:!0}),i&&i.silent||this.changeTabCallback(this.getActiveTab()))},getActiveTab:function(){return this.schema.findWhere({active:!0})},getActiveTabIndex:function(){return this.schema.indexOf(this.getActiveTab())},getEnabled:function(){return this.schema.where({enabled:!0})},changeTabCallback:function(){}})},982:function(e,t,i){"use strict";function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e}).apply(this,arguments)}var r={photo:"stock-photo",vector:"stock-illustration",video:"stock-video"},n={ru:{photo:"стоковое-фото",vector:"векторное-изображение",video:"стоковое-видео"}},a={ru:{photo:"image",vector:"vector",video:"video"}},o=function(e,t,i){var s=e.features.getValueObject("FileName type translations")[i];return s&&Array.isArray(s)&&s.includes(t.type)},l=function(e){return void 0===e&&(e={}),r[e.type]},c=function(e,t){void 0===e&&(e={});var i=n[t];return i&&i[e.type]||null},d=function(e,t,i){void 0===t&&(t={});var s=void 0===i?{}:i,r=s.lang,n=s.thumb,a=void 0!==n&&n,d=t.filename||"";if(!e)return d;var u=r||e.lang;if(!o(e,t,u))return d;var h=(t.localizedTitles&&t.localizedTitles[u]||t.title).toLowerCase().replace(/[^а-яa-z0-9]/g,"-").replace(/[-]+/g,"-").replace(/^-+|-+$/g,"").split("-").slice(0,5).join("-")||"empty",p=a?l(t):c(t,u);return p&&(h=p+"-"+h),h};e.exports={prepareFilename:d,prepareThumbFilename:function(e,t,i){return void 0===t&&(t={}),void 0===i&&(i={}),d(e,t,s({},i,{thumb:!0}))},prepareFileEnding:function(e,t,i){void 0===t&&(t={});var s=(void 0===i?{}:i).lang,r="";if(!e)return r;var n=s||e.lang;if(!o(e,t,n))return r;r=""+t.id;var l=a[n];return l&&l[t.type]&&(r=""+l[t.type]+r),"-"+r}}},983:function(e,t,i){"use strict";function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e}).apply(this,arguments)}var r=i(0),n=i(52),a=i(1069),o=i(1009),l=i(796),c=i(982).prepareThumbFilename,d=i(1072),u=i(14).toMMSS,h=["jpg","mp4","webm"],p=a.prototype,f=(p.constructor,function(e,t){if(null==e)return{};var i,s,r={},n=Object.keys(e);for(s=0;s<n.length;s++)i=n[s],t.indexOf(i)>=0||(r[i]=e[i]);return r}(p,["constructor"]));e.exports=n.extend(f).extend({url:"File",defaults:s({},a.prototype.defaults,{blocked:!1,published:null,buffs:[],inCart:!1,inFavorites:!1,free:!1,discount:0,purchased:[],licensed:[],editorial:!1,nudity:null,mp:"",ar:"",fps:null,length:null,sellerName:"",avatar:null,level:null,views:null,url:null,title:"",localizedTitles:{},description:"",alt:"",categories:[],tags:[],shortTags:[],restrictions:{},lightfield:!1,hideActions:null,crelloTemplateThumb:""}),relations:{restrictions:d},parseFromFile:function(e){return e&&e.result&&e.result[0]?e.result[0]:{}},parseFromSearch:function(e){return e||{}},parseFromCollection:function(e){return e&&(e.url=this.makeFavoritesUrl(e),e.title=e.favoriteTitle,e.hideActions=!0),e||{}},parse:function(e,t){void 0===t&&(t={});var i=this[t.parser],s="function"==typeof i?i.call(this,e,t):e,n=this.getErrors(s,e);if(Object.keys(n).length)return this.validationError=n,this.trigger("invalid",this,n,{validationError:n}),{};var a=r.pick(s,Object.keys(this.defaults));return a.type={i:"image",t:"vector",v:"video",c:"crelloTemplate"}[s.type]||s.type,a.published=1e3*s.uploadTimestamp,a.title=s.title||s.description,a.alt=s.alt||a.title,a.purchased=function(e){var t=e&&e.purchase_info?e.purchase_info.purchased:[];return Object.values(t).map((function(e){return{size:"object"==typeof e?e.size:e,data:"object"==typeof e?e.data:{}}}))}(s),a.discount=function(e){return e.discount?e.discount:e.purchase_info&&e.purchase_info.lightbox_discount?parseInt(e.purchase_info.lightbox_discount,10):0}(s),a.free=100===a.discount,a.licensed=s.licensed||[],a.crelloTemplateThumb=s.crello_template,a},initialize:function(){this.videoThumbs={}},getQueryParams:function(){return r.pick(this.attributes,Object.keys(this.defaults))},getErrors:function(e,t){var i=this.getRespErrors(t);return Object.keys(i).length||Object.keys(e).length||(i.id=["Empty response"]),i},parseRelated:function(e,t){return this.parseFromFile(t)[{models:"same_model",similar:"similar",series:"series",portfolio:"portfolio"}[e]]||[]},getFreeInfo:function(){return this.get("free")||this.isFreeLicenseAvailable()?{freeLabel:"Free"}:{}},isFreeLicenseAvailable:function(){var e=this.app.licensor.getUserLicenses().find((function(e){return"attributed_free"===e.name}));return e&&e.bit&this.get("licenseMask")},isFreeCurated:function(){if(!this.get("buffs"))return!1;var e=this.get("buffs").find((function(e){return"curated"===e.name}));return e&&100===e.options.discount},getRestrictions:function(e){var t=this.get("restrictions");if(!t)return[];var i=t.get(e);return Array.isArray(i)?i:[]},toSearchResult:function(){return s({},this.serialize(),this.getFreeInfo(),{formattedLength:this.getFileLength(this.get("length"))})},getFileLength:function(e){return this.isVideo()?u(e):null},makeFavoritesUrl:function(e){return this.app.makeUrl({route:"Folder",folderName:e.favoriteName,folderId:e.favoriteId},{absolute:!0})},makeRelatedUrl:function(e,t){var i=e.offset,s=e.sorting,r=e.relatedTo;switch(r){case"portfolio":return this.app.makeUrl({route:"Search",seller:this.get("sellerId"),offset:i,sorting:s});case"series":r="serie";break;case"similar":r={image:"similar-images",vector:"similar-vectors",video:"similar-videos"}[this.get("type")]}return this.app.makeUrl({route:"Related",relatedItemId:this.get("id"),relatedTo:r,offset:i,sorting:s},{absolute:t})},getVideoThumbs:function(e){var t=this;if(void 0===e&&(e="wide"),this.isVideo())return this.videoThumbs&&this.videoThumbs[e]?this.videoThumbs[e]:(this.videoThumbs[e]={},h.forEach((function(i){t.videoThumbs[e][i]=l.getThumbUrl({ext:i,size:e,file:t.attributes,protocol:t.app.parsedUrl.protocol,genFilename:c.bind(t,t.app)})})),this.videoThumbs[e])},makeSizeLabel:function(e){return o.makeSizeLabel(this.attributes,e,this.toJSON())},getPurchase:function(e){return this.get("purchased").find((function(t){return t.size===e}))},setPurchase:function(e,t){var i=this.getPurchase(e);return i||(i={size:e,data:t||{}},this.get("purchased").push(i),this.trigger("change:purchased")),i},isBannedForCountry:function(){return this.getRestrictions("countries").includes(this.app.getCurrentCountryCode())},isPurchased:function(e){return!!this.getPurchase(e)},isLicensed:function(e){var t=this.app.licensor.getConfig().sizes;return this.get("licensed").some((function(i){return i.sizes&t[e]}))},isAvailableEnterpriseOnly:function(){return 2===this.get("permissionMask")},isFree:function(){return this.get("free")},isEditorial:function(){return this.get("editorial")},isFreeForSize:function(e){return this.isFree()&&"el0"!==e},isImage:function(){return"image"===this.get("type")},isVideo:function(){return"video"===this.get("type")},isVector:function(){return"vector"===this.get("type")},isAudio:function(){return!1}})}}]);